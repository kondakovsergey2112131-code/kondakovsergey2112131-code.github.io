<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>–ú–æ–π —Å–∞–π—Ç ‚Äî –∫–∞–∫ –±—ã–ª–æ + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + –¥—Ä—É–∑—å—è</title>
  <style>
    :root{ --bg1:#6a11cb; --bg2:#2575fc; --muted:#a9b7cc; --card:#0f1322; --border:#2b3963; }
    *{ box-sizing:border-box }
    body {
      margin:0; font-family:'Segoe UI',Arial,sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#fff; text-align:center; overflow-x:hidden;
    }
    header { padding:48px 20px 24px; display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:8px; }
    h1 { flex:1 1 100%; font-size:2.4rem; margin:0 0 6px; }
    p.lead { flex:1 1 100%; font-size:1.1rem; opacity:.9; margin:0 0 14px; }
    .btn {
      display:inline-block; margin:6px 6px 0; padding:12px 22px;
      background:#fff; color:#2575fc; font-weight:700; border-radius:30px;
      text-decoration:none; transition:.25s; cursor:pointer; border:0;
    }
    .btn:hover { background:#ffdd57; color:#333; transform:translateY(-1px); }
    .btn.ghost{ background: rgba(255,255,255,.18); color:#fff; border:1px solid rgba(255,255,255,.35); }
    .btn.ghost:hover{ background: rgba(255,255,255,.28); color:#fff; }
    .hello{ display:inline-block; margin-left:8px; font-size:.95rem; color:#eaf2ff; opacity:.95; min-height:1em; }
    main { padding:28px 20px 48px; }
    main h2{ margin:0 0 10px }
    img.preview {
      max-width:320px; border-radius:16px; box-shadow:0 12px 28px rgba(0,0,0,.35);
      transition:transform .3s ease;
    }
    img.preview:hover { transform:rotate(2deg) scale(1.04); }
    footer { background:rgba(0,0,0,.2); padding:16px; font-size:.9rem; }

    /* Fullscreen overlays */
    .overlay{
      display:none; position:fixed; inset:0; z-index:9998;
      justify-content:center; align-items:center; background:#000;
    }
    .overlay img{
      max-width:none !important; width:100vw; height:100vh; object-fit:cover;
      display:block; user-select:none; -webkit-user-drag:none; pointer-events:none;
      box-shadow:none; border-radius:0; transition:none;
    }
    #bsod{ z-index:10000; background:#0078d7; cursor:none; }

    /* Chat widget (–∫–∞–∫ –±—ã–ª–æ) */
    #chatWidget{
      position:fixed; right:20px; bottom:-420px; width:340px;
      background:#fff; color:#111; border-radius:16px;
      box-shadow:0 18px 40px rgba(0,0,0,.35); z-index:5000;
      overflow:hidden; transition:bottom .5s ease;
      font-family:"Segoe UI", Arial, sans-serif;
    }
    body.sv-show #chatWidget{ bottom:20px; }
    #sv-ad{ display:flex; gap:12px; padding:14px; align-items:center; }
    #sv-ad .sv-photo{ flex:0 0 64px; width:64px; height:64px; border-radius:10px; overflow:hidden; }
    #sv-ad .sv-photo img{ width:100%; height:100%; object-fit:cover; display:block; }
    #sv-ad .sv-text{ flex:1; text-align:left; }
    #sv-ad .sv-title{ font-size:18px; font-weight:700; line-height:1.15; margin:0 0 6px 0; }
    #sv-ad .sv-sub{ color:#1ea94d; font-size:14px; margin-bottom:8px; }
    #sv-ad .sv-btn{
      display:inline-flex; align-items:center; gap:8px;
      background:#8e44ad; color:#fff; border:0; padding:10px 14px;
      border-radius:10px; cursor:pointer; font-weight:700;
      animation: svBlink 1.6s ease-in-out infinite;
    }
    #sv-ad .sv-badge{
      width:10px; height:10px; border-radius:50%;
      background:#ff3b30; box-shadow:0 0 0 2px #8e44ad;
    }
    #sv-chat{ display:none; flex-direction:column; height:420px; }
    #sv-chat .sv-header{
      display:flex; align-items:center; gap:10px;
      padding:12px 14px; background:#2575fc; color:#fff; user-select:none;
    }
    #sv-chat .sv-header .sv-avatar{ width:36px; height:36px; border-radius:50%; overflow:hidden; background:#fff; }
    #sv-chat .sv-header .sv-avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    #sv-chat .sv-name{ font-weight:700; }
    #sv-chat .sv-close{ margin-left:auto; cursor:pointer; font-size:18px; opacity:.9; }
    #sv-chat .sv-messages{ flex:1; padding:12px; overflow-y:auto; background:#f7f8fa; }
    .sv-msg{ max-width:82%; margin:6px 0; padding:10px 12px; border-radius:10px; word-wrap:break-word; }
    .sv-from{ background:#fff; border:1px solid #e9edf3; text-align:left; }
    .sv-to{ background:#e7f0ff; margin-left:auto; text-align:left; }
    #sv-chat .sv-input{ display:flex; gap:8px; padding:10px; border-top:1px solid #e6e9ef; background:#fff; }
    #sv-chat .sv-input input{ flex:1; border:1px solid #d8dee9; border-radius:10px; padding:10px; font-size:14px; }
    #sv-chat .sv-input button{ background:#2575fc; color:#fff; border:0; border-radius:10px; padding:10px 14px; cursor:pointer; }

    #chatWidget img{ max-width:none; box-shadow:none; border-radius:0; transition:none; }

    /* typing indicator */
    .typing{ display:inline-flex; align-items:center; gap:4px; padding:8px 10px; background:#fff; border:1px solid #e9edf3; border-radius:10px; }
    .typing .dot{ width:6px; height:6px; border-radius:50%; background:#9db1cc; animation:jump 1.2s infinite; }
    .typing .dot:nth-child(2){ animation-delay:.15s }
    .typing .dot:nth-child(3){ animation-delay:.3s }
    @keyframes jump{ 0%,100%{ transform:translateY(0); opacity:.6 } 50%{ transform:translateY(-4px); opacity:1 } }

    @keyframes svBlink {
      0%,100%{ transform:scale(1); box-shadow:0 0 0 rgba(142,68,173,0); filter:brightness(1); }
      50%{ transform:scale(1.04); box-shadow:0 0 22px rgba(142,68,173,.55); filter:brightness(1.08); }
    }
    @media (prefers-reduced-motion: reduce) {
      #sv-ad .sv-btn{ animation:none !important; }
    }
    @media (max-width:420px){ #chatWidget{ width:92vw; right:4vw; } }

    /* Call overlay (–∫–∞–∫ –±—ã–ª–æ) */
    :root { --apple-green:#34C759; --apple-red:#FF3B30; --apple-bg: rgba(0,0,0,.45); }
    .callui-overlay {
      position: fixed; inset: 0;
      display: none;
      align-items: center; justify-content: center;
      background: var(--apple-bg);
      backdrop-filter: blur(6px);
      z-index: 9999;
    }
    .callui-card {
      width: min(92vw, 420px);
      border-radius: 28px;
      background: #0B0B0C;
      color: #fff;
      padding: 22px 22px 26px;
      box-shadow: 0 30px 80px rgba(0,0,0,.35);
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "Segoe UI", Roboto, Arial;
      animation: callui-pop .22s ease-out;
    }
    @keyframes callui-pop { from {opacity:0; transform: translateY(8px) scale(.98);} to {opacity:1; transform:none;} }
    .callui-status { opacity: .7; font-size: 14px; margin-bottom: 6px; text-align: center; }
    .callui-title { text-align: center; font-weight: 600; font-size: 20px; margin: 6px 0 2px; }
    .callui-sub { text-align:center; opacity:.6; font-size:13px; margin-bottom: 16px; }
    .callui-phone {
      width: 54px; height: 54px; margin: 8px auto 14px;
      display: grid; place-items: center; border-radius: 16px;
      background: linear-gradient(180deg, #1a1a1a, #0f0f10);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05), 0 8px 20px rgba(0,0,0,.45);
      animation: callui-pulse 1.2s ease-in-out infinite;
    }
    @keyframes callui-pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06)} }
    .callui-actions { display:flex; gap:16px; justify-content: center; margin-top: 12px; }
    .callui-btn {
      width: 68px; height: 68px; border-radius: 50%;
      display:grid; place-items:center; cursor:pointer; user-select:none; border:none;
      background: #1c1c1d;
      transition: transform .06s ease, filter .2s ease;
    }
    .callui-btn:active { transform: scale(.97); }
    .callui-accept { background: var(--apple-green); }
    .callui-decline { background: var(--apple-red); }
    .callui-caption { text-align:center; font-size:12px; margin-top:6px; opacity:.85; }
    .callui-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 6px;}
    .callui-col { text-align:center; }
    .callui-timer { text-align:center; font-size:16px; font-weight:600; margin-top:12px; letter-spacing:1px; color:#67ffb5; min-height:22px; font-variant-numeric:tabular-nums; }

    /* AUTH modal (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π) */
    .auth-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:12000; backdrop-filter:blur(4px); }
    .auth-card{ width:min(92vw,420px); background:var(--card); color:#e8eef4; border-radius:18px; box-shadow:0 20px 70px rgba(0,0,0,.6); padding:18px; text-align:left; }
    .auth-title{ margin:0 0 8px; font-size:1.1rem; }
    .auth-tabs{ display:flex; gap:6px; margin-bottom:10px; }
    .auth-tab{ flex:1; padding:10px; background:#1c2236; color:#9fb0c8; border:0; border-radius:10px; cursor:pointer; font-weight:700; }
    .auth-tab.active{ background:#2b3963; color:#fff; }
    .auth-field{ margin:8px 0; }
    .auth-field label{ display:block; font-size:12px; color:#9fb0c8; margin-bottom:4px; }
    .auth-field input{ width:100%; padding:10px; border-radius:10px; border:1px solid var(--border); background:#131a2d; color:#e8eef4; }
    .auth-actions{ display:flex; gap:8px; margin-top:10px; }
    .auth-actions button{ flex:1; padding:10px; border-radius:10px; border:0; cursor:pointer; font-weight:700; }
    .auth-primary{ background:#4f75ff; color:#fff; }
    .auth-secondary{ background:#29314a; color:#fff; }
    .auth-error{ color:#ff7676; font-size:12px; min-height:16px; margin-top:6px; }
    .auth-hint{ font-size:12px; color:#9fb0c8; margin-top:6px; }

    /* Toast */
    .toast{ position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#111827; color:#fff; padding:10px 14px; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.35); z-index:13000; display:none; }

    /* Social modal (–°–æ–æ–±—â–µ—Å—Ç–≤–æ) */
    .social-card{ width:min(96vw,860px); background:#0b1022; color:#e8eef4; border-radius:18px; box-shadow:0 20px 70px rgba(0,0,0,.6); padding:16px; text-align:left; }
    .social-head{ display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .social-head h3{ margin:0; font-size:1.2rem; }
    .social-tabs{ display:flex; gap:6px; margin-bottom:12px; }
    .social-tab{ padding:8px 12px; border-radius:10px; background:#151c35; color:#9fb0c8; border:1px solid #243054; cursor:pointer; }
    .social-tab.active{ background:#243054; color:#fff; }
    .social-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .social-col{ background:#0e1530; border:1px solid #22305a; border-radius:12px; padding:10px; min-height:180px; }
    .social-list{ display:flex; flex-direction:column; gap:8px; max-height:320px; overflow:auto; }
    .social-item{ display:flex; align-items:center; justify-content:space-between; gap:10px; background:#0f1836; border:1px solid #263567; border-radius:10px; padding:8px 10px; }
    .social-name{ font-weight:700; }
    .social-email{ font-size:12px; color:#9fb0c8; }
    .mini{ font-size:12px; opacity:.8; }
    .social-actions button{ padding:6px 10px; border:0; border-radius:8px; cursor:pointer; font-weight:700; }
    .act{ background:#4f75ff; color:#fff; }
    .muted{ background:#263567; color:#c7d2fe; }
    .danger{ background:#7f1d1d; color:#fff; }
    @media (max-width:860px){ .social-grid{ grid-template-columns:1fr; } }
  </style>
  <!-- Supabase JS (client) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –º–æ–π —Å–∞–π—Ç</h1>
    <p class="lead">–í—Å—ë –∫–∞–∫ —Ä–∞–Ω—å—à–µ: —Å–∫—Ä–∏–º–µ—Ä, —á–∞—Ç, ¬´–∑–≤–æ–Ω–æ–∫¬ª. –î–æ–±–∞–≤–ª–µ–Ω—ã: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ ¬´–°–æ–æ–±—â–µ—Å—Ç–≤–æ¬ª —Å –¥—Ä—É–∑—å—è–º–∏.</p>
    <button class="btn" id="moreBtn">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ</button>
    <button class="btn ghost" id="authOpen">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    <button class="btn" id="logoutBtn" style="display:none">–í—ã–π—Ç–∏</button>
    <button class="btn ghost" id="socialOpen">–°–æ–æ–±—â–µ—Å—Ç–≤–æ üë•</button>
    <span class="hello" id="hello"></span>
  </header>

  <main>
    <h2>–û–±–æ –º–Ω–µ</h2>
    <p>–ö–æ–≥–¥–∞ –∂–∏–∑–Ω—å –¥–∞—ë—Ç –∫–∞–º–Ω–∏ ‚Äî –ø–æ–¥–Ω–∏–º–∞–π—Å—è –≤—ã—à–µ –∏ —Å–º–æ—Ç—Ä–∏ —à–∏—Ä–µ.</p>
    <img class="preview" src="myphoto.jpg" alt="–ú–æ—ë —Ñ–æ—Ç–æ" onerror="this.style.display='none'">
  </main>

  <footer>
    <p>¬© 2025 –ú–æ–π —Å–∞–π—Ç | –°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –∏ HTML</p>
  </footer>

  <!-- Screamer & BSOD -->
  <div id="screamer" class="overlay" aria-hidden="true">
    <img src="screamer.jpg" alt="">
    <audio id="screamSound" src="scream.mp3"></audio>
  </div>
  <div id="bsod" class="overlay" aria-hidden="true" title="–ö–ª–∏–∫ ‚Äî –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞">
    <img src="bsod.png" alt="">
  </div>

  <!-- Chat widget (–∫–∞–∫ –±—ã–ª–æ) -->
  <div id="chatWidget" aria-live="polite">
    <div id="sv-ad">
      <div class="sv-photo">
        <img src="orig.png" alt="–°–≤–µ—Ç–ª–∞–Ω–∞" onerror="this.onerror=null; this.src='orig.jpg';">
      </div>
      <div class="sv-text">
        <div class="sv-title">–°–≤–µ—Ç–ª–∞–Ω–∞ –Ω–∞ —Å–≤—è–∑–∏</div>
        <div class="sv-sub"> 300–º –æ—Ç –í–∞—Å </div>
        <button class="sv-btn" id="sv-open"><span>–û–¢–í–ï–¢–ò–¢–¨</span><span class="sv-badge"></span></button>
      </div>
    </div>
    <div id="sv-chat">
      <div class="sv-header">
        <div class="sv-avatar"><img src="orig.png" alt="" onerror="this.onerror=null; this.src='orig.jpg';"></div>
        <div class="sv-name">–°–≤–µ—Ç–ª–∞–Ω–∞ ‚Ä¢ –ò–ò</div>
        <div class="sv-close" id="sv-close" title="–°–≤–µ—Ä–Ω—É—Ç—å">√ó</div>
      </div>
      <div class="sv-messages" id="sv-msgs">
        <div class="sv-msg sv-from"><b>–°–≤–µ—Ç–ª–∞–Ω–∞:</b> –ü—Ä–∏–≤–µ—Ç! –Ø —Ä—è–¥–æ–º. –ß–µ–º –ø–æ–º–æ—á—å? üòä</div>
      </div>
      <div class="sv-input">
        <input type="text" id="sv-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶">
        <button id="sv-send">‚û§</button>
      </div>
    </div>
  </div>

  <!-- Call overlay (–∫–∞–∫ –±—ã–ª–æ) -->
  <div class="callui-overlay" id="callui">
    <div class="callui-card" role="dialog" aria-labelledby="calluiTitle" aria-describedby="calluiDesc">
      <div class="callui-status" id="calluiDesc">–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫</div>
      <div class="callui-phone" aria-hidden="true">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 011 1V20a1 1 0 01-1 1C11.3 21 3 12.7 3 2a1 1 0 011-1h3.5a1 1 0 011 1c0 1.25.2 2.46.57 3.58.11.32.03.68-.22.93l-2.23 2.23z" fill="currentColor"/>
        </svg>
      </div>
      <div class="callui-title" id="calluiTitle">–°–≤–µ—Ç–ª–∞–Ω–∞</div>
      <div class="callui-sub">–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —á–∞—Ç–∞</div>
      <div class="callui-actions">
        <div class="callui-grid" style="width: 220px;">
          <div class="callui-col">
            <button class="callui-btn callui-decline" id="calluiDecline" aria-label="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M21.16 13.87c-.73-.59-3.69-2.87-9.16-2.87s-8.43 2.28-9.16 2.87A1.99 1.99 0 002 15.45V17a2 2 0 002 2h2c.74 0 1.38-.41 1.72-1.02l.74-1.34a1.5 1.5 0 00-.55-2.03 12.47 12.47 0 014.37-.78c1.54 0 3.02.27 4.37.78.73.28 1.03 1.12.55 2.03l.74 1.34c.34.61.98 1.02 1.72 1.02h2a2 2 0 002-2v-1.55c0-.6-.27-1.17-.84-1.58z" fill="currentColor"/>
              </svg>
            </button>
            <div class="callui-caption">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</div>
          </div>
          <div class="callui-col">
            <button class="callui-btn callui-accept" id="calluiAccept" aria-label="–ü—Ä–∏–Ω—è—Ç—å –∑–≤–æ–Ω–æ–∫">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 011 1V20a1 1 0 01-1 1C11.3 21 3 12.7 3 2a1 1 0 011-1h3.5a1 1 0 011 1c0 1.25.2 2.46.57 3.58.11.32.03.68-.22.93l-2.23 2.23z" fill="currentColor"/>
              </svg>
            </button>
            <div class="callui-caption">–û—Ç–≤–µ—Ç–∏—Ç—å</div>
          </div>
        </div>
      </div>
      <div class="callui-timer" id="calluiTimer"></div>
    </div>
  </div>

  <!-- AUTH Modal -->
  <div class="auth-overlay" id="auth">
    <div class="auth-card">
      <h3 class="auth-title" id="authTitle">–í—Ö–æ–¥</h3>
      <div class="auth-tabs">
        <button class="auth-tab active" id="tabLogin">–í–æ–π—Ç–∏</button>
        <button class="auth-tab" id="tabRegister">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
      <div id="regNameWrap" class="auth-field" style="display:none">
        <label>–ò–º—è</label>
        <input type="text" id="regName" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è">
      </div>
      <div class="auth-field">
        <label>Email</label>
        <input type="email" id="authEmail" placeholder="you@example.com" autocomplete="email">
      </div>
      <div class="auth-field">
        <label>–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="authPass" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" autocomplete="current-password">
      </div>
      <div id="regConfirmWrap" class="auth-field" style="display:none">
        <label>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
        <input type="password" id="authPass2" placeholder="–ï—â—ë —Ä–∞–∑ –ø–∞—Ä–æ–ª—å" autocomplete="new-password">
      </div>
      <div class="auth-actions">
        <button class="auth-secondary" id="authCancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="auth-primary" id="authSubmit">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
      <div class="auth-error" id="authError"></div>
      <div class="auth-hint">–î–µ–º–æ: –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (localStorage). –î–ª—è –¥—Ä—É–∑–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Supabase (–Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–ª—é—á–∏).</div>
    </div>
  </div>

  <!-- SOCIAL Modal -->
  <div class="auth-overlay" id="social">
    <div class="social-card">
      <div class="social-head">
        <h3>–°–æ–æ–±—â–µ—Å—Ç–≤–æ</h3>
        <span class="mini" id="socialStatus"></span>
        <button class="btn ghost" id="socialClose" style="margin-left:auto;padding:8px 14px;">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div class="social-tabs">
        <button class="social-tab active" id="tabUsers">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
        <button class="social-tab" id="tabRequests">–ó–∞—è–≤–∫–∏</button>
        <button class="social-tab" id="tabFriends">–î—Ä—É–∑—å—è</button>
      </div>
      <div class="social-grid">
        <div class="social-col">
          <div class="mini">–°–ø–∏—Å–æ–∫</div>
          <div id="listUsers" class="social-list"></div>
        </div>
        <div class="social-col">
          <div class="mini">–î–µ—Ç–∞–ª–∏</div>
          <div class="social-list">
            <div id="listRequests" style="display:none"></div>
            <div id="listFriends" style="display:none"></div>
            <div id="hintBox" class="mini">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É: ¬´–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏¬ª, ¬´–ó–∞—è–≤–∫–∏¬ª, ¬´–î—Ä—É–∑—å—è¬ª.</div>
          </div>
        </div>
      </div>
      <div class="mini" style="margin-top:8px">
        –ü–æ–¥—Å–∫–∞–∑–∫–∞: —á—Ç–æ–±—ã —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–ª–∏, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–¥–µ <b>SUPABASE_URL</b> –∏ <b>SUPABASE_ANON_KEY</b>, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ======= Page baseline (–∫–∞–∫ –±—ã–ª–æ) =======
    window.addEventListener('load',()=>{ setTimeout(()=>document.body.classList.add('sv-show'),1200); });
    const moreBtn=document.getElementById('moreBtn');
    const screamer=document.getElementById('screamer');
    const bsod=document.getElementById('bsod');
    const screamSound=document.getElementById('screamSound');
    moreBtn.addEventListener('click',()=>{
      const el=document.documentElement;
      (el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen||(()=>{})).call(el);
      screamer.style.display='flex';
      try{ screamSound.currentTime=0; screamSound.play(); }catch(_){}
      setTimeout(()=>{ screamer.style.display='none'; bsod.style.display='flex'; },2000);
    });
    bsod.addEventListener('click',()=>location.reload());

    // Chat controls –∫–∞–∫ –±—ã–ª–æ
    const svOpen=document.getElementById('sv-open');
    const svAd=document.getElementById('sv-ad');
    const svChat=document.getElementById('sv-chat');
    const svClose=document.getElementById('sv-close');
    const svMsgs=document.getElementById('sv-msgs');
    const svInput=document.getElementById('sv-input');
    const svSend=document.getElementById('sv-send');
    svOpen.addEventListener('click',(e)=>{ e.preventDefault(); svAd.style.display='none'; svChat.style.display='flex'; setTimeout(()=>svInput.focus(),50); });
    svClose.addEventListener('click',()=>{ svChat.style.display='none'; svAd.style.display='flex'; });

    /* ====== Audio (ring/accept/end) ====== */
    let actx=null, masterGain=null, rtGain=null, rtOsc1=null, rtOsc2=null, rtTick=null;
    function ensureAudio(){
      if(!actx){
        actx=new (window.AudioContext||window.webkitAudioContext)();
        masterGain=actx.createGain(); masterGain.gain.value=0.9; masterGain.connect(actx.destination);
      }
      if(actx.state==='suspended'){ actx.resume?.(); }
    }
    function stopRingtone(){
      if(rtTick){ clearInterval(rtTick); rtTick=null; }
      try{ rtGain && (rtGain.gain.value=0); }catch(e){}
      try{ rtOsc1 && rtOsc1.stop(0); }catch(e){}
      try{ rtOsc2 && rtOsc2.stop(0); }catch(e){}
      rtGain=null; rtOsc1=null; rtOsc2=null;
    }
    function playRingtone(){
      ensureAudio(); stopRingtone();
      rtGain=actx.createGain(); rtGain.gain.value=0; rtGain.connect(masterGain);
      rtOsc1=actx.createOscillator(); rtOsc1.type='sine'; rtOsc1.frequency.value=440;
      rtOsc2=actx.createOscillator(); rtOsc2.type='sine'; rtOsc2.frequency.value=660;
      rtOsc1.connect(rtGain); rtOsc2.connect(rtGain);
      rtOsc1.start(); rtOsc2.start();
      function burst(){
        const now=actx.currentTime, g=rtGain.gain;
        g.cancelScheduledValues(now);
        g.setValueAtTime(0.0, now);
        g.linearRampToValueAtTime(0.22, now+0.02);
        g.setValueAtTime(0.22, now+0.38);
        g.linearRampToValueAtTime(0.0, now+0.42);
        g.setValueAtTime(0.0, now+0.62);
        g.linearRampToValueAtTime(0.22, now+0.64);
        g.setValueAtTime(0.22, now+1.00);
        g.linearRampToValueAtTime(0.0, now+1.04);
      }
      burst();
      rtTick=setInterval(burst, 2600);
    }
    function blip(type='up'){
      ensureAudio();
      const o=actx.createOscillator(), g=actx.createGain(); o.type='sine'; g.gain.value=0; o.connect(g).connect(masterGain);
      const now=actx.currentTime;
      if(type==='up'){ o.frequency.setValueAtTime(660, now); o.frequency.exponentialRampToValueAtTime(1200, now+0.16);
        g.gain.linearRampToValueAtTime(0.22, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.24);
        o.start(now); o.stop(now+0.26);
      } else { o.frequency.setValueAtTime(900, now); o.frequency.exponentialRampToValueAtTime(360, now+0.22);
        g.gain.linearRampToValueAtTime(0.22, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.24);
        o.start(now); o.stop(now+0.26); }
    }

    /* ====== TTS (female ru-RU) ====== */
    function pickRUVoice(){
      const voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
      if(!voices || !voices.length) return null;
      const ru = voices.filter(v => (v.lang||'').toLowerCase().startsWith('ru'));
      const prefer = ['milena','irina','tatiana','tatyana','oksana','katya','katia','anna','google —Ä—É—Å—Å–∫–∏–π','microsoft irina'];
      for(const name of prefer){ const v = ru.find(v => v.name && v.name.toLowerCase().includes(name)); if(v) return v; }
      return ru[0] || voices[0] || null;
    }
    function ensureVoicesReady(){
      return new Promise(resolve=>{
        if(!('speechSynthesis' in window)) return resolve(false);
        const voices = speechSynthesis.getVoices();
        if(voices && voices.length) return resolve(true);
        const t = setTimeout(()=>resolve(true), 700);
        speechSynthesis.onvoiceschanged = () => { clearTimeout(t); resolve(true); };
      });
    }
    function speakRU(text, opts={}){
      if(!('speechSynthesis' in window)) return false;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ru-RU'; u.rate = opts.rate ?? 1; u.pitch = opts.pitch ?? 1.15; u.volume = opts.volume ?? 1;
      const v = pickRUVoice(); if(v) u.voice = v;
      try{ speechSynthesis.cancel(); }catch(_){}
      try{ speechSynthesis.speak(u); return true; }catch(_){ return false; }
    }

    /* ====== Call UI control (–∫–∞–∫ –±—ã–ª–æ) ====== */
    (function(){
      const overlay = document.getElementById('callui');
      const decline = document.getElementById('calluiDecline');
      const accept = document.getElementById('calluiAccept');
      const status = document.getElementById('calluiDesc');
      const timer = document.getElementById('calluiTimer');
      let callInterval = null, callStartTime = null;

      function formatTimer(sec){ const m = String(Math.floor(sec/60)).padStart(2,'0'); const s = String(sec%60).padStart(2,'0'); return `${m}:${s}`; }
      function openUI(){ overlay.style.display='flex'; status.textContent='–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫'; timer.textContent=''; document.documentElement.style.overflow='hidden'; clearInterval(callInterval); callStartTime=null; playRingtone(); }
      function closeUI(playEnd=true){ overlay.style.display='none'; document.documentElement.style.overflow=''; clearInterval(callInterval); timer.textContent=''; callStartTime=null; stopRingtone(); if(playEnd) blip('down'); }
      window.__callUI = { open: openUI, close: closeUI };

      decline.addEventListener('click', () => closeUI(true));
      accept.addEventListener('click', async () => {
        stopRingtone(); blip('up'); status.textContent='–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ‚Ä¶'; timer.textContent=''; clearInterval(callInterval);
        setTimeout(async ()=>{
          status.textContent='–ó–≤–æ–Ω–æ–∫ –∏–¥–µ—Ç'; callStartTime=Date.now(); timer.textContent='00:00';
          callInterval=setInterval(()=>{ const s=Math.floor((Date.now()-callStartTime)/1000); timer.textContent=formatTimer(s); },1000);
          await ensureVoicesReady(); speakRU('–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ –°–≤–µ—Ç–ª–∞–Ω–∞. –¢—ã –º–µ–Ω—è —Å–ª—ã—à–∏—à—å?', { pitch:1.2, rate:1.0 });
        },1200);
      });
      overlay.addEventListener('click', e=>{ if(e.target===overlay) closeUI(true); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && overlay.style.display==='flex') closeUI(true); });
    })();

    /* ====== AI-like replies (–∫–∞–∫ –±—ã–ª–æ) ====== */
    function detectIntent(t){
      const s = (t||'').toLowerCase();
      if(/[^\w]?(–ø—Ä–∏–≤|–∑–¥—Ä–∞|—Ö–∞–π|–∫—É|—Å–∞–ª—é—Ç)/.test(s)) return 'greet';
      if(/(–∫–∞–∫ –¥–µ–ª–∞|–∫–∞–∫ —Ç—ã|—á—Ç–æ –¥–µ–ª–∞–µ—à—å)/.test(s)) return 'smalltalk';
      if(/(–≥–¥–µ|—Ä—è–¥–æ–º|—Ç—ã –≥–¥–µ|–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ|–ª–æ–∫–∞—Ü)/.test(s)) return 'where';
      if(/(—Ü–µ–Ω–∞|—Å–∫–æ–ª—å–∫–æ|–ø—Ä–∞–π—Å)/.test(s)) return 'price';
      if(/(—Å–æ–∑–≤–æ–Ω|–ø–æ–∑–≤–æ–Ω|–∑–≤–æ–Ω–æ–∫|–ø–æ–∑–≤–æ–Ω–∏–º|—Å–≤—è–∂–µ–º—Å—è)/.test(s)) return 'call';
      if(/[?]$/.test(s)) return 'question';
      return 'other';
    }
    function genReply(text){
      const intent = detectIntent(text);
      const rand = (arr)=>arr[Math.floor(Math.random()*arr.length)];
      const fillers = ['üôÇ','üòâ','‚ú®','üëç','üìû','üí¨'];
      if(intent==='call'){ return '–û–≥–æ, –¥–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è! ' + rand(fillers); }
      switch(intent){
        case 'greet': return rand(['–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —É —Ç–µ–±—è –¥–µ–ª–∞?','–ü—Ä–∏–≤–µ—Ç–∏–∫ üòä –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?','–°–∞–ª—é—Ç! –ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º?']) + ' ' + rand(fillers);
        case 'smalltalk': return rand(['–û—Ç–ª–∏—á–Ω–æ, –Ω–∞ —Å–≤—è–∑–∏!','–í—Å—ë —Ö–æ—Ä–æ—à–æ, —Ä—è–¥–æ–º üòâ','–ü–∏—à—É –∫–æ–¥ –∏ –¥—É–º–∞—é –æ –∫–æ—Ñ–µ ‚òï']) + ' ' + rand(fillers);
        case 'where': return rand(['–Ø –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ ‚Äî –º–∏–Ω—É—Ç 5 –æ—Ç —Ç–µ–±—è.','–Ø —Ç—É—Ç, –Ω–µ–¥–∞–ª–µ–∫–æ. –ú–æ–≥—É –ø–æ–¥–æ–π—Ç–∏.','–í —Ä–∞–π–æ–Ω–µ, –µ—Å–ª–∏ —á—Ç–æ ‚Äî –º–∞—è–∫—É–π.']) + ' ' + rand(fillers);
        case 'price': return rand(['–†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ ‚Äî –ø–æ–¥—Å–∫–∞–∂—É –≤–∞—Ä–∏–∞–Ω—Ç—ã.','–î–∞–≤–∞–π —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏, –∏ —è —Å–∫–∞–∂—É —Ç–æ—á–Ω–µ–µ.','–ù–∞–ø–∏—à–∏, —á—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º ‚Äî —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—é –ø–æ —Ü–µ–Ω–µ.']) + ' ' + rand(fillers);
        case 'question': return '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! ' + rand(['–°–∫–∞–∂–∏ —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ?','–î–∞–≤–∞–π —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏.','–ï—Å—Ç—å –ø–∞—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Äî –∫–∞–∫–æ–π –±–ª–∏–∂–µ?']) + ' ' + rand(fillers);
        default: return rand(['–ü–æ–Ω—è–ª–∞ —Ç–µ–±—è.','–û–∫–µ–π!','–°—É–ø–µ—Ä!']) + ' ' + (text||'').trim();
      }
    }
    function addTyping(){
      const wrap=document.createElement('div'); wrap.className='sv-msg sv-from'; wrap.id='typing';
      wrap.innerHTML='<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>';
      svMsgs.appendChild(wrap); svMsgs.scrollTop=svMsgs.scrollHeight;
    }
    function removeTyping(){ const t=document.getElementById('typing'); if(t) t.remove(); }
    function aiRespond(userText){
      const reply = genReply(userText);
      const delay = Math.min(2200, 300 + reply.length*20);
      addTyping();
      setTimeout(()=>{
        removeTyping();
        const m=document.createElement('div'); m.className='sv-msg sv-from'; m.innerHTML='<b>–°–≤–µ—Ç–ª–∞–Ω–∞:</b> ' + reply;
        svMsgs.appendChild(m); svMsgs.scrollTop=svMsgs.scrollHeight;
        if (reply.includes('–û–≥–æ, –¥–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è!')){
          setTimeout(()=>{ window.__callUI?.open(); }, 2000);
        }
      }, delay);
    }
    function sendMsg(){
      const text=svInput.value.trim();
      if(!text) return;
      const mine=document.createElement('div');
      mine.className='sv-msg sv-to';
      mine.innerHTML=`<b>–í—ã:</b> ${text}`;
      svMsgs.appendChild(mine);
      svInput.value='';
      svMsgs.scrollTop=svMsgs.scrollHeight;
      aiRespond(text);
    }
    svSend.addEventListener('click',sendMsg);
    svInput.addEventListener('keydown',e=>{ if(e.key==='Enter') sendMsg(); });

    // ===== Optional registration (no gating) =====
    const toast = document.getElementById('toast');
    function showToast(msg, ms=2200){ toast.textContent=msg; toast.style.display='block'; clearTimeout(showToast._t); showToast._t=setTimeout(()=>{ toast.style.display='none'; }, ms); }
    const authOverlay = document.getElementById('auth');
    const authOpen = document.getElementById('authOpen');
    const logoutBtn = document.getElementById('logoutBtn');
    const hello = document.getElementById('hello');
    const tabLogin = document.getElementById('tabLogin');
    const tabRegister = document.getElementById('tabRegister');
    const regNameWrap = document.getElementById('regNameWrap');
    const regConfirmWrap = document.getElementById('regConfirmWrap');
    const regName = document.getElementById('regName');
    const authEmail = document.getElementById('authEmail');
    const authPass = document.getElementById('authPass');
    const authPass2 = document.getElementById('authPass2');
    const authSubmit = document.getElementById('authSubmit');
    const authCancel = document.getElementById('authCancel');
    const authError = document.getElementById('authError');
    const authTitle = document.getElementById('authTitle');
    let mode = 'login';
    function openAuth(wanted='login'){
      mode = wanted;
      authTitle.textContent = wanted==='login' ? '–í—Ö–æ–¥' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
      tabLogin.classList.toggle('active', wanted==='login');
      tabRegister.classList.toggle('active', wanted==='register');
      regNameWrap.style.display = wanted==='register' ? '' : 'none';
      regConfirmWrap.style.display = wanted==='register' ? '' : 'none';
      authEmail.value=''; authPass.value=''; authPass2.value=''; regName.value='';
      authError.textContent='';
      authOverlay.style.display='flex';
      setTimeout(()=>authEmail.focus(), 30);
    }
    function closeAuth(){ authOverlay.style.display='none'; }
    tabLogin.addEventListener('click',()=>openAuth('login'));
    tabRegister.addEventListener('click',()=>openAuth('register'));
    authOpen.addEventListener('click',()=>openAuth('login'));
    authCancel.addEventListener('click',closeAuth);
    authOverlay.addEventListener('click',e=>{ if(e.target===authOverlay) closeAuth(); });

    function isValidEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }
    function sha256(str){
      const enc = new TextEncoder().encode(str);
      return crypto.subtle.digest('SHA-256', enc).then(buf => {
        const b = new Uint8Array(buf);
        let s=''; for(let i=0;i<b.length;i++){ s+=String.fromCharCode(b[i]); }
        return btoa(s);
      });
    }
    function getUser(){ try{ return JSON.parse(localStorage.getItem('sv_user')||'null'); }catch(e){ return null; } }
    function setUser(u){ localStorage.setItem('sv_user', JSON.stringify(u)); }
    function clearUser(){ localStorage.removeItem('sv_user'); }
    function updateAuthUI(){
      const u = getUser();
      if(u){ hello.textContent = '–ü—Ä–∏–≤–µ—Ç, ' + (u.name||u.email); authOpen.style.display='none'; logoutBtn.style.display='inline-block'; }
      else { hello.textContent = ''; authOpen.style.display='inline-block'; logoutBtn.style.display='none'; }
    }
    logoutBtn.addEventListener('click',()=>{ clearUser(); updateAuthUI(); showToast('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞'); });
    authSubmit.addEventListener('click', async ()=>{
      const email = authEmail.value.trim().toLowerCase();
      const pass = authPass.value;
      const name = regName.value.trim();
      if(!isValidEmail(email)){ authError.textContent='–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email'; return; }
      if(pass.length < 6){ authError.textContent='–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 6 —Å–∏–º–≤–æ–ª–æ–≤'; return; }
      if(mode==='register'){
        if(pass !== authPass2.value){ authError.textContent='–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'; return; }
        const passHash = await sha256(pass);
        const db = JSON.parse(localStorage.getItem('sv_users')||'{}');
        if(db[email]){ authError.textContent='–¢–∞–∫–æ–π email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'; return; }
        db[email] = { passHash, name, createdAt: Date.now() };
        localStorage.setItem('sv_users', JSON.stringify(db));
        setUser({ email, name });
        closeAuth(); updateAuthUI(); showToast('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞');
        syncProfileToSupabase().catch(()=>{});
      }else{
        const db = JSON.parse(localStorage.getItem('sv_users')||'{}');
        if(!db[email]){ authError.textContent='–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.'; return; }
        const passHash = await sha256(pass);
        if(db[email].passHash !== passHash){ authError.textContent='–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å'; return; }
        setUser({ email, name: db[email].name });
        closeAuth(); updateAuthUI(); showToast('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
        syncProfileToSupabase().catch(()=>{});
      }
    });
    updateAuthUI();

    // ====== Supabase social (users + friends) ======
    // 1) –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à–∏ –∫–ª—é—á–∏
    const SUPABASE_URL = "https://YOUR-PROJECT.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";
    const sb = (typeof supabase!=='undefined' && SUPABASE_URL.startsWith('http') && SUPABASE_ANON_KEY.length>20) ? supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;

    function sbReady(){ if(!sb){ showToast('Supabase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω'); return false; } return true; }
    async function syncProfileToSupabase(){
      if(!sbReady()) return;
      const u = getUser(); if(!u) return;
      await sb.from('profiles').upsert({ email: u.email, name: u.name||u.email }).then(({error})=>{ if(error) console.warn(error); });
    }

    // UI
    const socialOverlay = document.getElementById('social');
    const socialOpen = document.getElementById('socialOpen');
    const socialClose = document.getElementById('socialClose');
    const tabUsers = document.getElementById('tabUsers');
    const tabRequests = document.getElementById('tabRequests');
    const tabFriends = document.getElementById('tabFriends');
    const listUsers = document.getElementById('listUsers');
    const listRequests = document.getElementById('listRequests');
    const listFriends = document.getElementById('listFriends');
    const hintBox = document.getElementById('hintBox');
    const socialStatus = document.getElementById('socialStatus');

    function openSocial(){
      socialOverlay.style.display='flex';
      setTab('users');
      refreshAll();
    }
    function closeSocial(){ socialOverlay.style.display='none'; }
    socialOpen.addEventListener('click', openSocial);
    socialClose.addEventListener('click', closeSocial);
    socialOverlay.addEventListener('click', e=>{ if(e.target===socialOverlay) closeSocial(); });

    function setTab(tab){
      tabUsers.classList.toggle('active', tab==='users');
      tabRequests.classList.toggle('active', tab==='requests');
      tabFriends.classList.toggle('active', tab==='friends');
      listRequests.style.display = tab==='requests' ? '' : 'none';
      listFriends.style.display = tab==='friends' ? '' : 'none';
      hintBox.style.display = tab==='users' ? '' : 'none';
    }
    tabUsers.addEventListener('click', ()=>{ setTab('users'); refreshUsers(); });
    tabRequests.addEventListener('click', ()=>{ setTab('requests'); refreshRequests(); });
    tabFriends.addEventListener('click', ()=>{ setTab('friends'); refreshFriends(); });

    function getMe(){ return getUser(); }

    function renderUserItem(p){
      const me = getMe();
      const isMe = me && me.email===p.email;
      const wrap = document.createElement('div'); wrap.className='social-item';
      wrap.innerHTML = `<div><div class="social-name">${p.name||p.email}</div><div class="social-email">${p.email}</div></div>`;
      const actions = document.createElement('div'); actions.className='social-actions';
      if(!isMe){
        const btn = document.createElement('button'); btn.className='act'; btn.textContent='–î–æ–±–∞–≤–∏—Ç—å';
        btn.addEventListener('click', ()=>sendRequest(p.email));
        actions.appendChild(btn);
      } else {
        const meb = document.createElement('span'); meb.className='mini'; meb.textContent='—ç—Ç–æ –≤—ã';
        actions.appendChild(meb);
      }
      wrap.appendChild(actions);
      return wrap;
    }

    function renderRequestItem(r){
      const wrap = document.createElement('div'); wrap.className='social-item';
      wrap.innerHTML = `<div><div class="social-name">–ó–∞—è–≤–∫–∞ –æ—Ç</div><div class="social-email">${r.from_email}</div></div>`;
      const actions = document.createElement('div'); actions.className='social-actions';
      const acc = document.createElement('button'); acc.className='act'; acc.textContent='–ü—Ä–∏–Ω—è—Ç—å'; acc.onclick=()=>acceptRequest(r.id);
      const dec = document.createElement('button'); dec.className='muted'; dec.textContent='–û—Ç–∫–ª–æ–Ω–∏—Ç—å'; dec.onclick=()=>declineRequest(r.id);
      actions.appendChild(acc); actions.appendChild(dec);
      wrap.appendChild(actions);
      return wrap;
    }

    function renderFriendItem(f){
      const wrap = document.createElement('div'); wrap.className='social-item';
      wrap.innerHTML = `<div><div class="social-name">${f.name||f.email}</div><div class="social-email">${f.email}</div></div>`;
      const actions = document.createElement('div'); actions.className='social-actions';
      const rm = document.createElement('button'); rm.className='danger'; rm.textContent='–£–¥–∞–ª–∏—Ç—å'; rm.onclick=()=>removeFriendship(f.email);
      actions.appendChild(rm);
      wrap.appendChild(actions);
      return wrap;
    }

    function setStatus(text){ socialStatus.textContent = text||''; }

    async function refreshUsers(){
      listUsers.innerHTML = '';
      if(!sbReady()) return;
      const { data, error } = await sb.from('profiles').select('email,name,created_at').order('created_at', { ascending:false }).limit(200);
      if(error){ setStatus('–û—à–∏–±–∫–∞: '+error.message); return; }
      setStatus('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: '+data.length);
      data.forEach(p=> listUsers.appendChild(renderUserItem(p)) );
    }

    async function refreshRequests(){
      listRequests.innerHTML = '';
      if(!sbReady()) return;
      const me = getMe(); if(!me){ setStatus('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∑–∞—è–≤–∫–∏'); return; }
      const { data, error } = await sb.from('friend_requests').select('id,from_email,to_email,status,created_at').eq('to_email', me.email).eq('status','pending').order('created_at', { ascending:false });
      if(error){ setStatus('–û—à–∏–±–∫–∞: '+error.message); return; }
      setStatus('–ó–∞—è–≤–æ–∫: '+data.length);
      data.forEach(r=> listRequests.appendChild(renderRequestItem(r)) );
    }

    async function refreshFriends(){
      listFriends.innerHTML = '';
      if(!sbReady()) return;
      const me = getMe(); if(!me){ setStatus('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –¥—Ä—É–∑–µ–π'); return; }
      const { data, error } = await sb.from('friend_requests').select('id,from_email,to_email,status,created_at').eq('status','accepted').or(`from_email.eq.${me.email},to_email.eq.${me.email}`);
      if(error){ setStatus('–û—à–∏–±–∫–∞: '+error.message); return; }
      // —Å–æ–±—Ä–∞—Ç—å —Å–ø–∏—Å–æ–∫ email –¥—Ä—É–∑–µ–π
      const others = [];
      data.forEach(r=>{
        const other = r.from_email===me.email ? r.to_email : r.from_email;
        if(!others.includes(other)) others.push(other);
      });
      if(others.length===0){ setStatus('–î—Ä—É–∑–µ–π –ø–æ–∫–∞ –Ω–µ—Ç'); return; }
      const { data: profs, error: e2 } = await sb.from('profiles').select('email,name').in('email', others);
      if(e2){ setStatus('–û—à–∏–±–∫–∞: '+e2.message); return; }
      profs.forEach(p=> listFriends.appendChild(renderFriendItem(p)) );
      setStatus('–î—Ä—É–∑–µ–π: '+profs.length);
    }

    async function sendRequest(toEmail){
      const me = getMe(); if(!me){ openAuth('login'); showToast('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –¥—Ä—É–∑—å—è'); return; }
      if(!sbReady()) return;
      if(me.email===toEmail){ showToast('–°–∞–º–æ–≥–æ —Å–µ–±—è –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–ª—å–∑—è'); return; }
      const { error } = await sb.from('friend_requests').insert({ from_email: me.email, to_email: toEmail, status:'pending' });
      if(error){ showToast('–û—à–∏–±–∫–∞: '+error.message); }
      else { showToast('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞'); refreshRequests(); }
    }
    async function acceptRequest(id){
      if(!sbReady()) return;
      const { error } = await sb.from('friend_requests').update({ status:'accepted' }).eq('id', id);
      if(error){ showToast('–û—à–∏–±–∫–∞: '+error.message); } else { showToast('–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞'); refreshFriends(); refreshRequests(); }
    }
    async function declineRequest(id){
      if(!sbReady()) return;
      const { error } = await sb.from('friend_requests').update({ status:'declined' }).eq('id', id);
      if(error){ showToast('–û—à–∏–±–∫–∞: '+error.message); } else { showToast('–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'); refreshRequests(); }
    }
    async function removeFriendship(otherEmail){
      if(!sbReady()) return;
      const me = getMe(); if(!me) return;
      const { error } = await sb.from('friend_requests')
        .delete()
        .eq('status','accepted')
        .or(`and(from_email.eq.${me.email},to_email.eq.${otherEmail}),and(from_email.eq.${otherEmail},to_email.eq.${me.email})`);
      if(error){ showToast('–û—à–∏–±–∫–∞: '+error.message); } else { showToast('–£–¥–∞–ª–µ–Ω–æ'); refreshFriends(); }
    }
    async function refreshAll(){
      await syncProfileToSupabase().catch(()=>{});
      await refreshUsers();
      await refreshRequests();
      await refreshFriends();
    }
  </script>

  <!-- Helper: SQL to create tables (for Supabase) -->
  <details style="margin:14px auto; width:min(92vw,900px); text-align:left; background:rgba(0,0,0,.18); padding:10px 14px; border-radius:12px;">
    <summary>SQL –¥–ª—è Supabase (—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è) ‚Äî –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å</summary>
    <pre style="white-space:pre-wrap; color:#eaeaea;">
-- –ü—Ä–æ—Ñ–∏–ª–∏
create table if not exists public.profiles (
  email text primary key,
  name text,
  created_at timestamptz default now()
);

-- –ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è
create table if not exists public.friend_requests (
  id uuid primary key default gen_random_uuid(),
  from_email text not null references public.profiles(email) on delete cascade,
  to_email   text not null references public.profiles(email) on delete cascade,
  status text not null check (status in ('pending','accepted','declined')) default 'pending',
  created_at timestamptz default now(),
  unique (from_email, to_email)
);

-- –í–∫–ª—é—á–∞–µ–º RLS
alter table public.profiles enable row level security;
alter table public.friend_requests enable row level security;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ (–¥–µ–º–æ: –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ —Å anon key)
create policy "profiles_select_all" on public.profiles for select using (true);
create policy "profiles_upsert_all" on public.profiles for insert with check (true);
create policy "profiles_update_all" on public.profiles for update using (true) with check (true);

create policy "frequests_select_all" on public.friend_requests for select using (true);
create policy "frequests_insert_all" on public.friend_requests for insert with check (true);
create policy "frequests_update_all" on public.friend_requests for update using (true) with check (true);
create policy "frequests_delete_all" on public.friend_requests for delete using (true);
    </pre>
    <div class="mini">–í–∞–∂–Ω–æ: —ç—Ç–æ —É—á–µ–±–Ω—ã–π —Ä–µ–∂–∏–º ‚Äî –ª—é–±–æ–π, —É –∫–æ–≥–æ –µ—Å—Ç—å –≤–∞—à anon‚Äëkey, —Å–º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—ã. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ç—Ä–æ–≥–∏–µ RLS-–ø–æ–ª–∏—Ç–∏–∫–∏ (–ø–æ JWT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).</div>
  </details>
</body>
</html>
