<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>–ú–æ–π —Å–∞–π—Ç ‚Äî —á–∞—Ç —Å –ò–ò</title>
  <style>
    body {
      margin:0; font-family:'Segoe UI',Arial,sans-serif;
      background:linear-gradient(135deg,#6a11cb,#2575fc);
      color:#fff; text-align:center; overflow-x:hidden;
    }
    header { padding:50px 20px; animation:fadeInDown 1.2s ease; }
    h1 { font-size:2.2rem; margin:0; }
    p { font-size:1.1rem; opacity:.9; }
    .btn {
      display:inline-block; margin-top:20px; padding:12px 25px;
      background:#fff; color:#2575fc; font-weight:bold; border-radius:30px;
      text-decoration:none; transition:.3s; cursor:pointer;
      border:0;
    }
    .btn:hover { background:#ffdd57; color:#333; transform:scale(1.05); }
    main { padding:24px 20px 40px; animation:fadeInUp 1.2s ease; }
    img {
      max-width:300px; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,.3);
      transition:transform .3s ease;
    }
    img:hover { transform:rotate(2deg) scale(1.05); }
    footer { background:rgba(0,0,0,.2); padding:15px; font-size:.9rem; }
    @keyframes fadeInDown { from{opacity:0; transform:translateY(-30px)} to{opacity:1; transform:translateY(0)} }
    @keyframes fadeInUp   { from{opacity:0; transform:translateY(30px)}  to{opacity:1; transform:translateY(0)} }

    .overlay{
      display:none; position:fixed; inset:0; z-index:9999;
      justify-content:center; align-items:center; background:#000;
    }
    .overlay img{
      max-width:none !important; width:100vw; height:100vh; object-fit:cover;
      display:block; user-select:none; -webkit-user-drag:none; pointer-events:none;
      box-shadow:none; border-radius:0; transition:none;
    }
    #bsod{ z-index:10000; background:#0078d7; cursor:none; }

    #chatWidget{
      position:fixed; right:20px; bottom:-420px; width:340px;
      background:#fff; color:#111; border-radius:14px;
      box-shadow:0 12px 30px rgba(0,0,0,.35); z-index:5000;
      overflow:hidden; transition:bottom .5s ease;
      font-family:"Segoe UI", Arial, sans-serif;
    }
    body.sv-show #chatWidget{ bottom:20px; }

    #sv-ad{ display:flex; gap:12px; padding:14px; align-items:center; }
    #sv-ad .sv-photo{ flex:0 0 64px; width:64px; height:64px; border-radius:8px; overflow:hidden; }
    #sv-ad .sv-photo img{ width:100%; height:100%; object-fit:cover; display:block; }
    #sv-ad .sv-text{ flex:1; }
    #sv-ad .sv-title{ font-size:18px; font-weight:700; line-height:1.15; margin:0 0 6px 0; }
    #sv-ad .sv-sub{ color:#1ea94d; font-size:18px; margin-bottom:8px; }
    #sv-ad .sv-btn{
      display:inline-flex; align-items:center; gap:8px;
      background:#8e44ad; color:#fff; border:0; padding:10px 14px;
      border-radius:8px; cursor:pointer; font-weight:700;
      animation: svBlink 1.6s ease-in-out infinite;
    }
    #sv-ad .sv-badge{
      width:10px; height:10px; border-radius:50%;
      background:#ff3b30; box-shadow:0 0 0 2px #8e44ad;
    }

    #sv-chat{ display:none; flex-direction:column; height:400px; }
    #sv-chat .sv-header{
      display:flex; align-items:center; gap:10px;
      padding:12px 14px; background:#2575fc; color:#fff;
    }
    #sv-chat .sv-header .sv-avatar{ width:36px; height:36px; border-radius:50%; overflow:hidden; background:#fff; }
    #sv-chat .sv-header .sv-avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    #sv-chat .sv-name{ font-weight:700; }
    #sv-chat .sv-close{ margin-left:auto; cursor:pointer; font-size:18px; opacity:.85; }
    #sv-chat .sv-messages{ flex:1; padding:12px; overflow-y:auto; background:#f7f8fa; }
    .sv-msg{ max-width:80%; margin:6px 0; padding:10px 12px; border-radius:10px; }
    .sv-from{ background:#fff; border:1px solid #e9edf3; }
    .sv-to{ background:#e7f0ff; margin-left:auto; }
    #sv-chat .sv-input{ display:flex; gap:8px; padding:10px; border-top:1px solid #e6e9ef; background:#fff; }
    #sv-chat .sv-input input{ flex:1; border:1px solid #d8dee9; border-radius:8px; padding:10px; font-size:14px; }
    #sv-chat .sv-input button{ background:#2575fc; color:#fff; border:0; border-radius:8px; padding:10px 14px; cursor:pointer; }

    #chatWidget img{ max-width:none; box-shadow:none; border-radius:0; transition:none; }

    /* typing indicator */
    .typing{ display:inline-flex; align-items:center; gap:4px; padding:8px 10px; background:#fff; border:1px solid #e9edf3; border-radius:10px; }
    .typing .dot{ width:6px; height:6px; border-radius:50%; background:#9db1cc; animation:jump 1.2s infinite; }
    .typing .dot:nth-child(2){ animation-delay:.15s }
    .typing .dot:nth-child(3){ animation-delay:.3s }
    @keyframes jump{ 0%,100%{ transform:translateY(0); opacity:.6 } 50%{ transform:translateY(-4px); opacity:1 } }

    @keyframes svBlink {
      0%,100%{ transform:scale(1); box-shadow:0 0 0 rgba(142,68,173,0); filter:brightness(1); }
      50%{ transform:scale(1.04); box-shadow:0 0 22px rgba(142,68,173,.55); filter:brightness(1.08); }
    }
    @media (prefers-reduced-motion: reduce) {
      #sv-ad .sv-btn{ animation:none !important; }
    }
    @media (max-width:420px){ #chatWidget{ width:92vw; right:4vw; } }
  </style>

  <!-- iOS-style CALL OVERLAY -->
  <style>
    :root {
      --apple-green:#34C759;
      --apple-red:#FF3B30;
      --apple-bg: rgba(0,0,0,.45);
    }
    .callui-overlay {
      position: fixed; inset: 0;
      display: none;
      align-items: center; justify-content: center;
      background: var(--apple-bg);
      backdrop-filter: blur(6px);
      z-index: 9999;
    }
    .callui-card {
      width: min(92vw, 420px);
      border-radius: 28px;
      background: #0B0B0C;
      color: #fff;
      padding: 22px 22px 26px;
      box-shadow: 0 30px 80px rgba(0,0,0,.35);
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "Segoe UI", Roboto, Arial;
      animation: callui-pop .22s ease-out;
    }
    @keyframes callui-pop { from {opacity:0; transform: translateY(8px) scale(.98);} to {opacity:1; transform:none;} }
    .callui-status { opacity: .7; font-size: 14px; margin-bottom: 6px; text-align: center; }
    .callui-title { text-align: center; font-weight: 600; font-size: 20px; margin: 6px 0 2px; }
    .callui-sub { text-align:center; opacity:.6; font-size:13px; margin-bottom: 16px; }
    .callui-phone {
      width: 54px; height: 54px; margin: 8px auto 14px;
      display: grid; place-items: center; border-radius: 16px;
      background: linear-gradient(180deg, #1a1a1a, #0f0f10);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05), 0 8px 20px rgba(0,0,0,.45);
      animation: callui-pulse 1.2s ease-in-out infinite;
    }
    @keyframes callui-pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06)} }
    .callui-actions { display:flex; gap:16px; justify-content: center; margin-top: 12px; }
    .callui-btn {
      width: 68px; height: 68px; border-radius: 50%;
      display:grid; place-items:center; cursor:pointer; user-select:none; border:none;
      background: #1c1c1d;
      transition: transform .06s ease, filter .2s ease;
    }
    .callui-btn:active { transform: scale(.97); }
    .callui-accept { background: var(--apple-green); }
    .callui-decline { background: var(--apple-red); }
    .callui-caption { text-align:center; font-size:12px; margin-top:6px; opacity:.85; }
    .callui-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 6px;}
    .callui-col { text-align:center; }
    .callui-timer {
      text-align:center;
      font-size:16px; font-weight:600; margin-top:12px; letter-spacing:1px;
      color:#67ffb5; min-height:22px; font-variant-numeric:tabular-nums;
    }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <header>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –º–æ–π —Å–∞–π—Ç</h1>
    <p>–¢–µ–ø–µ—Ä—å –°–≤–µ—Ç–ª–∞–Ω–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∫–∞–∫ ¬´–ò–ò¬ª –ø—Ä—è–º–æ –≤ —á–∞—Ç–µ.</p>
    <div class="btn" id="moreBtn">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ</div>
  </header>

  <div id="chatWidget" aria-live="polite">
    <div id="sv-ad">
      <div class="sv-photo">
        <img src="orig.png" alt="–°–≤–µ—Ç–ª–∞–Ω–∞" onerror="this.onerror=null; this.src='orig.jpg';">
      </div>
      <div class="sv-text">
        <div class="sv-title">–°–≤–µ—Ç–ª–∞–Ω–∞ –Ω–∞ —Å–≤—è–∑–∏</div>
        <div class="sv-sub"> 300–º –æ—Ç –í–∞—Å </div>
        <button class="sv-btn" id="sv-open"><span>–û–¢–í–ï–¢–ò–¢–¨</span><span class="sv-badge"></span></button>
      </div>
    </div>
    <div id="sv-chat">
      <div class="sv-header">
        <div class="sv-avatar"><img src="orig.png" alt="" onerror="this.onerror=null; this.src='orig.jpg';"></div>
        <div class="sv-name">–°–≤–µ—Ç–ª–∞–Ω–∞ ‚Ä¢ –ò–ò</div>
        <div class="sv-close" id="sv-close">√ó</div>
      </div>
      <div class="sv-messages" id="sv-msgs">
        <div class="sv-msg sv-from"><b>–°–≤–µ—Ç–ª–∞–Ω–∞:</b> –ü—Ä–∏–≤–µ—Ç! –Ø —Ä—è–¥–æ–º. –ß–µ–º –ø–æ–º–æ—á—å? üòä</div>
      </div>
      <div class="sv-input">
        <input type="text" id="sv-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶">
        <button id="sv-send">‚û§</button>
      </div>
    </div>
  </div>

  <!-- CALL OVERLAY Markup -->
  <div class="callui-overlay" id="callui">
    <div class="callui-card" role="dialog" aria-labelledby="calluiTitle" aria-describedby="calluiDesc">
      <div class="callui-status" id="calluiDesc">–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫</div>
      <div class="callui-phone" aria-hidden="true">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 011 1V20a1 1 0 01-1 1C11.3 21 3 12.7 3 2a1 1 0 011-1h3.5a1 1 0 011 1c0 1.25.2 2.46.57 3.58.11.32.03.68-.22.93l-2.23 2.23z" fill="currentColor"/>
        </svg>
      </div>
      <div class="callui-title" id="calluiTitle">–°–≤–µ—Ç–ª–∞–Ω–∞</div>
      <div class="callui-sub">–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —á–∞—Ç–∞</div>

      <div class="callui-actions">
        <div class="callui-grid" style="width: 220px;">
          <div class="callui-col">
            <button class="callui-btn callui-decline" id="calluiDecline" aria-label="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M21.16 13.87c-.73-.59-3.69-2.87-9.16-2.87s-8.43 2.28-9.16 2.87A1.99 1.99 0 002 15.45V17a2 2 0 002 2h2c.74 0 1.38-.41 1.72-1.02l.74-1.34a1.5 1.5 0 00-.55-2.03 12.47 12.47 0 014.37-.78c1.54 0 3.02.27 4.37.78.73.28 1.03 1.12.55 2.03l.74 1.34c.34.61.98 1.02 1.72 1.02h2a2 2 0 002-2v-1.55c0-.6-.27-1.17-.84-1.58z" fill="currentColor"/>
              </svg>
            </button>
            <div class="callui-caption">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</div>
          </div>
          <div class="callui-col">
            <button class="callui-btn callui-accept" id="calluiAccept" aria-label="–ü—Ä–∏–Ω—è—Ç—å –∑–≤–æ–Ω–æ–∫">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 011 1V20a1 1 0 01-1 1C11.3 21 3 12.7 3 2a1 1 0 011-1h3.5a1 1 0 011 1c0 1.25.2 2.46.57 3.58.11.32.03.68-.22.93l-2.23 2.23z" fill="currentColor"/>
              </svg>
            </button>
            <div class="callui-caption">–û—Ç–≤–µ—Ç–∏—Ç—å</div>
          </div>
        </div>
      </div>
      <div class="callui-timer" id="calluiTimer"></div>
      <span class="sr-only" id="calluiLive" aria-live="polite"></span>
    </div>
  </div>

  <script>
    // Simple page actions just for demo
    window.addEventListener('load',()=>{ setTimeout(()=>document.body.classList.add('sv-show'),1200); });
    const svOpen=document.getElementById('sv-open');
    const svAd=document.getElementById('sv-ad');
    const svChat=document.getElementById('sv-chat');
    const svMsgs=document.getElementById('sv-msgs');
    const svInput=document.getElementById('sv-input');
    const svSend=document.getElementById('sv-send');

    svOpen.addEventListener('click', (e)=>{
      e.preventDefault();
      svAd.style.display='none';
      svChat.style.display='flex';
      setTimeout(()=>svInput.focus(),50);
    });

    /* ====== Call sounds (ring/accept/end) ====== */
    let actx=null, masterGain=null, rtGain=null, rtOsc1=null, rtOsc2=null, rtTick=null;
    function ensureAudio(){
      if(!actx){ actx=new (window.AudioContext||window.webkitAudioContext)(); masterGain=actx.createGain(); masterGain.gain.value=0.9; masterGain.connect(actx.destination); }
    }
    function stopRingtone(){
      if(rtTick){ clearInterval(rtTick); rtTick=null; }
      try{ rtGain && (rtGain.gain.value=0); }catch(e){}
      try{ rtOsc1 && rtOsc1.stop(0); }catch(e){}
      try{ rtOsc2 && rtOsc2.stop(0); }catch(e){}
      rtGain=null; rtOsc1=null; rtOsc2=null;
    }
    function playRingtone(){
      ensureAudio(); stopRingtone();
      rtGain=actx.createGain(); rtGain.gain.value=0; rtGain.connect(masterGain);
      rtOsc1=actx.createOscillator(); rtOsc1.type='sine'; rtOsc1.frequency.value=440;
      rtOsc2=actx.createOscillator(); rtOsc2.type='sine'; rtOsc2.frequency.value=660;
      rtOsc1.connect(rtGain); rtOsc2.connect(rtGain);
      rtOsc1.start(); rtOsc2.start();
      function burst(){
        const now=actx.currentTime, g=rtGain.gain;
        g.cancelScheduledValues(now);
        g.setValueAtTime(0.0, now);
        g.linearRampToValueAtTime(0.22, now+0.02);
        g.setValueAtTime(0.22, now+0.38);
        g.linearRampToValueAtTime(0.0, now+0.42);
        g.setValueAtTime(0.0, now+0.62);
        g.linearRampToValueAtTime(0.22, now+0.64);
        g.setValueAtTime(0.22, now+1.00);
        g.linearRampToValueAtTime(0.0, now+1.04);
      }
      burst();
      rtTick=setInterval(burst, 2600);
    }
    function blip(type='up'){
      ensureAudio();
      const o=actx.createOscillator(), g=actx.createGain(); o.type='sine'; g.gain.value=0; o.connect(g).connect(masterGain);
      const now=actx.currentTime;
      if(type==='up'){ o.frequency.setValueAtTime(660, now); o.frequency.exponentialRampToValueAtTime(1200, now+0.16);
        g.gain.linearRampToValueAtTime(0.22, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.24);
        o.start(now); o.stop(now+0.26);
      } else { o.frequency.setValueAtTime(900, now); o.frequency.exponentialRampToValueAtTime(360, now+0.22);
        g.gain.linearRampToValueAtTime(0.22, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.24);
        o.start(now); o.stop(now+0.26); }
    }

    /* ====== TTS (female ru-RU) ====== */
    function pickRUVoice(){
      const voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
      if(!voices || !voices.length) return null;
      const ru = voices.filter(v => (v.lang||'').toLowerCase().startsWith('ru'));
      const prefer = ['milena','irina','tatiana','tatyana','oksana','katya','katia','anna','google —Ä—É—Å—Å–∫–∏–π','microsoft irina'];
      for(const name of prefer){ const v = ru.find(v => v.name && v.name.toLowerCase().includes(name)); if(v) return v; }
      return ru[0] || voices[0] || null;
    }
    function ensureVoicesReady(){
      return new Promise(resolve=>{
        if(!('speechSynthesis' in window)) return resolve(false);
        const voices = speechSynthesis.getVoices();
        if(voices && voices.length) return resolve(true);
        const t = setTimeout(()=>resolve(true), 700);
        speechSynthesis.onvoiceschanged = () => { clearTimeout(t); resolve(true); };
      });
    }
    function speakRU(text, opts={}){
      if(!('speechSynthesis' in window)) return false;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ru-RU'; u.rate = opts.rate ?? 1; u.pitch = opts.pitch ?? 1.15; u.volume = opts.volume ?? 1;
      const v = pickRUVoice(); if(v) u.voice = v;
      try{ speechSynthesis.cancel(); }catch(_){}
      try{ speechSynthesis.speak(u); return true; }catch(_){ return false; }
    }

    /* ====== Call UI control ====== */
    (function(){
      const overlay = document.getElementById('callui');
      const decline = document.getElementById('calluiDecline');
      const accept = document.getElementById('calluiAccept');
      const status = document.getElementById('calluiDesc');
      const timer = document.getElementById('calluiTimer');
      let callInterval = null, callStartTime = null;

      function formatTimer(sec){ const m = String(Math.floor(sec/60)).padStart(2,'0'); const s = String(sec%60).padStart(2,'0'); return `${m}:${s}`; }
      function openUI(){ overlay.style.display='flex'; status.textContent='–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫'; timer.textContent=''; document.documentElement.style.overflow='hidden'; clearInterval(callInterval); callStartTime=null; playRingtone(); }
      function closeUI(playEnd=true){ overlay.style.display='none'; document.documentElement.style.overflow=''; clearInterval(callInterval); timer.textContent=''; callStartTime=null; stopRingtone(); if(playEnd) blip('down'); }
      window.__callUI = { open: openUI, close: closeUI };

      decline.addEventListener('click', () => closeUI(true));
      accept.addEventListener('click', async () => {
        stopRingtone(); blip('up'); status.textContent='–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ‚Ä¶'; timer.textContent=''; clearInterval(callInterval);
        setTimeout(async ()=>{
          status.textContent='–ó–≤–æ–Ω–æ–∫ –∏–¥–µ—Ç'; callStartTime=Date.now(); timer.textContent='00:00';
          callInterval=setInterval(()=>{ const s=Math.floor((Date.now()-callStartTime)/1000); timer.textContent=formatTimer(s); },1000);
          await ensureVoicesReady(); speakRU('–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ –°–≤–µ—Ç–ª–∞–Ω–∞. –¢—ã –º–µ–Ω—è —Å–ª—ã—à–∏—à—å?', { pitch:1.2, rate:1.0 });
        },1200);
      });
      overlay.addEventListener('click', e=>{ if(e.target===overlay) closeUI(true); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && overlay.style.display==='flex') closeUI(true); });
    })();

    /* ====== AI-like replies (on-device rules) ====== */
    const memory = [];
    function clampLen(s, n){ return s.length>n ? s.slice(0,n)+'‚Ä¶' : s; }
    function detectIntent(t){
      const s = t.toLowerCase();
      if(/[^\w]?(–ø—Ä–∏–≤|–∑–¥—Ä–∞|—Ö–∞–π|–∫—É|—Å–∞–ª—é—Ç)/.test(s)) return 'greet';
      if(/(–∫–∞–∫ –¥–µ–ª–∞|–∫–∞–∫ —Ç—ã|—á—Ç–æ –¥–µ–ª–∞–µ—à—å)/.test(s)) return 'smalltalk';
      if(/(–≥–¥–µ|—Ä—è–¥–æ–º|—Ç—ã –≥–¥–µ|–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ|–ª–æ–∫–∞—Ü)/.test(s)) return 'where';
      if(/(—Ü–µ–Ω–∞|—Å–∫–æ–ª—å–∫–æ|–ø—Ä–∞–π—Å)/.test(s)) return 'price';
      if(/(—Å–æ–∑–≤–æ–Ω|–ø–æ–∑–≤–æ–Ω|–∑–≤–æ–Ω–æ–∫|–ø–æ–∑–≤–æ–Ω–∏–º|—Å–≤—è–∂–µ–º—Å—è)/.test(s)) return 'call';
      if(/[?]$/.test(s)) return 'question';
      return 'other';
    }
    function genReply(text){
      const intent = detectIntent(text);
      const t = text.toLowerCase();
      const rand = (arr)=>arr[Math.floor(Math.random()*arr.length)];
      const add = (base, tailArr)=> base + ' ' + rand(tailArr);
      let reply='';
      switch(intent){
        case 'greet':
          reply = rand(['–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —É —Ç–µ–±—è –¥–µ–ª–∞?','–ü—Ä–∏–≤–µ—Ç–∏–∫ üòä –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?','–°–∞–ª—é—Ç! –ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º?']); break;
        case 'smalltalk':
          reply = rand(['–û—Ç–ª–∏—á–Ω–æ, –Ω–∞ —Å–≤—è–∑–∏!','–í—Å—ë —Ö–æ—Ä–æ—à–æ, —Ä—è–¥–æ–º üòâ','–ü–∏—à—É –∫–æ–¥ –∏ –¥—É–º–∞—é –æ –∫–æ—Ñ–µ ‚òï']); break;
        case 'where':
          reply = rand(['–Ø –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ ‚Äî –º–∏–Ω—É—Ç 5 –æ—Ç —Ç–µ–±—è.','–Ø —Ç—É—Ç, –Ω–µ–¥–∞–ª–µ–∫–æ. –ú–æ–≥—É –ø–æ–¥–æ–π—Ç–∏.','–í —Ä–∞–π–æ–Ω–µ, –µ—Å–ª–∏ —á—Ç–æ ‚Äî –º–∞—è–∫—É–π.']); break;
        case 'price':
          reply = rand(['–†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ ‚Äî –ø–æ–¥—Å–∫–∞–∂—É –≤–∞—Ä–∏–∞–Ω—Ç—ã.','–î–∞–≤–∞–π —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏, –∏ —è —Å–∫–∞–∂—É —Ç–æ—á–Ω–µ–µ.','–ù–∞–ø–∏—à–∏, —á—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º ‚Äî —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—é –ø–æ —Ü–µ–Ω–µ.']); break;
        case 'call':
          reply = rand(['–û–≥–æ, –¥–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è!','–î–∞–≤–∞–π –≥–æ–ª–æ—Å–æ–º –æ–±—Å—É–¥–∏–º?','–ú–æ–≥—É –ø–æ–∑–≤–æ–Ω–∏—Ç—å ‚Äî —É–¥–æ–±–Ω–æ —Å–µ–π—á–∞—Å?']); break;
        case 'question':
          reply = '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! ' + rand(['–°–∫–∞–∂–∏ —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ?','–î–∞–≤–∞–π —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏.','–ï—Å—Ç—å –ø–∞—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Äî –∫–∞–∫–æ–π –±–ª–∏–∂–µ?']); break;
        default:
          // –ª—ë–≥–∫–æ–µ —ç—Ö–æ —Å –ø–µ—Ä–µ—Ñ—Ä–∞–∑–æ–º
          reply = rand(['–ü–æ–Ω—è–ª–∞ —Ç–µ–±—è.','–û–∫–µ–π!','–°—É–ø–µ—Ä!']) + ' ' + clampLen(text.replace(/\s+/g,' ').trim(), 80);
      }
      // –∏–Ω–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏–º —Å–º–∞–π–ª–∏–∫
      if(Math.random()<0.5) reply += ' ' + rand(['üôÇ','üòâ','‚ú®','üëç','üìû']);
      return reply.trim();
    }

    function addTyping(){
      const wrap=document.createElement('div'); wrap.className='sv-msg sv-from'; wrap.id='typing';
      wrap.innerHTML='<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>';
      svMsgs.appendChild(wrap); svMsgs.scrollTop=svMsgs.scrollHeight;
    }
    function removeTyping(){
      const t=document.getElementById('typing'); if(t) t.remove();
    }
    function aiRespond(userText){
      const reply = genReply(userText);
      // –ò–º–∏—Ç–∞—Ü–∏—è –Ω–∞–±–æ—Ä–∞: 300–º—Å + 20–º—Å/—Å–∏–º–≤–æ–ª (–¥–æ 2.2—Å –º–∞–∫—Å)
      const delay = Math.min(2200, 300 + reply.length*20);
      addTyping();
      setTimeout(()=>{
        removeTyping();
        const m=document.createElement('div'); m.className='sv-msg sv-from'; m.innerHTML='<b>–°–≤–µ—Ç–ª–∞–Ω–∞:</b> ' + reply;
        svMsgs.appendChild(m); svMsgs.scrollTop=svMsgs.scrollHeight;
        memory.push({ you:userText, sv:reply, ts:Date.now() });
        // –ï—Å–ª–∏ —Ñ—Ä–∞–∑–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–∏–≥–≥–µ—Ä ¬´–û–≥–æ, –¥–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è!¬ª, —á–µ—Ä–µ–∑ 2—Å ‚Äî –∑–≤–æ–Ω–æ–∫
        if (reply.includes('–û–≥–æ, –¥–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è!')){
          setTimeout(()=>{ window.__callUI?.open(); }, 2000);
        }
      }, delay);
    }

    function sendMsg(){
      const text=svInput.value.trim();
      if(!text) return;
      const mine=document.createElement('div');
      mine.className='sv-msg sv-to';
      mine.innerHTML=`<b>–í—ã:</b> ${text}`;
      svMsgs.appendChild(mine);
      svInput.value='';
      svMsgs.scrollTop=svMsgs.scrollHeight;
      aiRespond(text);
    }
    svSend.addEventListener('click',sendMsg);
    svInput.addEventListener('keydown',e=>{ if(e.key==='Enter') sendMsg(); });
  </script>
</body>
</html>
