<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>–ú–æ–π —Å–∞–π—Ç ‚Äî —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π</title>
  <style>
    :root{ --bg1:#6a11cb; --bg2:#2575fc; --muted:#a9b7cc; --card:#0f1322; --border:#2b3963; }
    *{ box-sizing:border-box }
    body {
      margin:0; font-family:'Segoe UI',Arial,sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#fff; text-align:center; overflow-x:hidden;
    }
    header {
      padding:14px 16px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:center;
    }
    header h1 { font-size:1.6rem; margin:0; }
    header .spacer{ flex:1 1 40px }
    .btn {
      display:inline-block; padding:9px 16px;
      background:#fff; color:#2575fc; font-weight:700; border-radius:30px;
      text-decoration:none; transition:.25s; cursor:pointer; border:0;
    }
    .btn:hover { background:#ffdd57; color:#333; transform:translateY(-1px); }
    .btn.ghost{ background: rgba(255,255,255,.18); color:#fff; border:1px solid rgba(255,255,255,.35); }
    .btn.ghost:hover{ background: rgba(255,255,255,.28); color:#fff; }
    .hello{ font-size:.95rem; color:#eaf2ff; opacity:.95; }
    main { padding:20px; }
    .lead { color:#eaf2ff; opacity:.9; margin:6px 0 0; }
    main h2{ margin:20px 0 10px }
    img.preview {
      max-width:320px; border-radius:16px; box-shadow:0 12px 28px rgba(0,0,0,.35);
      transition:transform .3s ease;
    }
    img.preview:hover { transform:rotate(2deg) scale(1.04); }
    footer { background:rgba(0,0,0,.2); padding:16px; font-size:.9rem; }

    /* Fullscreen overlays */
    .overlay{
      display:none; position:fixed; inset:0; z-index:9998;
      justify-content:center; align-items:center; background:#000;
    }
    .overlay img{
      max-width:none !important; width:100vw; height:100vh; object-fit:cover;
      display:block; user-select:none; -webkit-user-drag:none; pointer-events:none;
      box-shadow:none; border-radius:0; transition:none;
    }
    #bsod{ z-index:10000; background:#0078d7; cursor:none; }

    /* Chat widget */
    #chatWidget{
      position:fixed; right:20px; bottom:-420px; width:340px;
      background:#fff; color:#111; border-radius:16px;
      box-shadow:0 18px 40px rgba(0,0,0,.35); z-index:5000;
      overflow:hidden; transition:bottom .5s ease;
      font-family:"Segoe UI", Arial, sans-serif;
    }
    body.sv-show #chatWidget{ bottom:20px; }
    #sv-ad{ display:flex; gap:12px; padding:14px; align-items:center; }
    #sv-ad .sv-photo{ flex:0 0 64px; width:64px; height:64px; border-radius:10px; overflow:hidden; }
    #sv-ad .sv-photo img{ width:100%; height:100%; object-fit:cover; display:block; }
    #sv-ad .sv-text{ flex:1; text-align:left; }
    #sv-ad .sv-title{ font-size:18px; font-weight:700; line-height:1.15; margin:0 0 6px 0; }
    #sv-ad .sv-sub{ color:#1ea94d; font-size:14px; margin-bottom:8px; }
    #sv-ad .sv-btn{
      display:inline-flex; align-items:center; gap:8px;
      background:#8e44ad; color:#fff; border:0; padding:10px 14px;
      border-radius:10px; cursor:pointer; font-weight:700;
      animation: svBlink 1.6s ease-in-out infinite;
    }
    #sv-ad .sv-badge{
      width:10px; height:10px; border-radius:50%;
      background:#ff3b30; box-shadow:0 0 0 2px #8e44ad;
    }
    #sv-chat{ display:none; flex-direction:column; height:420px; }
    #sv-chat .sv-header{
      display:flex; align-items:center; gap:10px;
      padding:12px 14px; background:#2575fc; color:#fff;
    }
    #sv-chat .sv-header .sv-avatar{ width:36px; height:36px; border-radius:50%; overflow:hidden; background:#fff; }
    #sv-chat .sv-header .sv-avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    #sv-chat .sv-name{ font-weight:700; }
    #sv-chat .sv-close{ margin-left:auto; cursor:pointer; font-size:18px; opacity:.9; }
    #sv-chat .sv-messages{ flex:1; padding:12px; overflow-y:auto; background:#f7f8fa; }
    .sv-msg{ max-width:82%; margin:6px 0; padding:10px 12px; border-radius:10px; word-wrap:break-word; }
    .sv-from{ background:#fff; border:1px solid #e9edf3; text-align:left; }
    .sv-to{ background:#e7f0ff; margin-left:auto; text-align:left; }
    #sv-chat .sv-input{ display:flex; gap:8px; padding:10px; border-top:1px solid #e6e9ef; background:#fff; }
    #sv-chat .sv-input input{ flex:1; border:1px solid #d8dee9; border-radius:10px; padding:10px; font-size:14px; }
    #sv-chat .sv-input button{ background:#2575fc; color:#fff; border:0; border-radius:10px; padding:10px 14px; cursor:pointer; }

    #chatWidget img{ max-width:none; box-shadow:none; border-radius:0; transition:none; }

    /* typing indicator */
    .typing{ display:inline-flex; align-items:center; gap:4px; padding:8px 10px; background:#fff; border:1px solid #e9edf3; border-radius:10px; }
    .typing .dot{ width:6px; height:6px; border-radius:50%; background:#9db1cc; animation:jump 1.2s infinite; }
    .typing .dot:nth-child(2){ animation-delay:.15s }
    .typing .dot:nth-child(3){ animation-delay:.3s }
    @keyframes jump{ 0%,100%{ transform:translateY(0); opacity:.6 } 50%{ transform:translateY(-4px); opacity:1 } }

    @keyframes svBlink {
      0%,100%{ transform:scale(1); box-shadow:0 0 0 rgba(142,68,173,0); filter:brightness(1); }
      50%{ transform:scale(1.04); box-shadow:0 0 22px rgba(142,68,173,.55); filter:brightness(1.08); }
    }
    @media (prefers-reduced-motion: reduce) {
      #sv-ad .sv-btn{ animation:none !important; }
    }
    @media (max-width:420px){ #chatWidget{ width:92vw; right:4vw; } }

    /* Call overlay */
    :root { --apple-green:#34C759; --apple-red:#FF3B30; --apple-bg: rgba(0,0,0,.45); }
    .callui-overlay {
      position: fixed; inset: 0;
      display: none;
      align-items: center; justify-content: center;
      background: var(--apple-bg);
      backdrop-filter: blur(6px);
      z-index: 9999;
    }
    .callui-card {
      width: min(92vw, 420px);
      border-radius: 28px;
      background: #0B0B0C;
      color: #fff;
      padding: 22px 22px 26px;
      box-shadow: 0 30px 80px rgba(0,0,0,.35);
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "Segoe UI", Roboto, Arial;
      animation: callui-pop .22s ease-out;
    }
    @keyframes callui-pop { from {opacity:0; transform: translateY(8px) scale(.98);} to {opacity:1; transform:none;} }
    .callui-status { opacity: .7; font-size: 14px; margin-bottom: 6px; text-align: center; }
    .callui-title { text-align: center; font-weight: 600; font-size: 20px; margin: 6px 0 2px; }
    .callui-sub { text-align:center; opacity:.6; font-size:13px; margin-bottom: 16px; }
    .callui-phone {
      width: 54px; height: 54px; margin: 8px auto 14px;
      display: grid; place-items: center; border-radius: 16px;
      background: linear-gradient(180deg, #1a1a1a, #0f0f10);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05), 0 8px 20px rgba(0,0,0,.45);
      animation: callui-pulse 1.2s ease-in-out infinite;
    }
    @keyframes callui-pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06)} }
    .callui-actions { display:flex; gap:16px; justify-content: center; margin-top: 12px; }
    .callui-btn {
      width: 68px; height: 68px; border-radius: 50%;
      display:grid; place-items:center; cursor:pointer; user-select:none; border:none;
      background: #1c1c1d;
      transition: transform .06s ease, filter .2s ease;
    }
    .callui-btn:active { transform: scale(.97); }
    .callui-accept { background: var(--apple-green); }
    .callui-decline { background: var(--apple-red); }
    .callui-caption { text-align:center; font-size:12px; margin-top:6px; opacity:.85; }
    .callui-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 6px;}
    .callui-col { text-align:center; }
    .callui-timer { text-align:center; font-size:16px; font-weight:600; margin-top:12px; letter-spacing:1px; color:#67ffb5; min-height:22px; font-variant-numeric:tabular-nums; }

    /* AUTH modal */
    .auth-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:12000; backdrop-filter:blur(4px); }
    .auth-card{ width:min(92vw,420px); background:var(--card); color:#e8eef4; border-radius:18px; box-shadow:0 20px 70px rgba(0,0,0,.6); padding:18px; text-align:left; }
    .auth-title{ margin:0 0 8px; font-size:1.1rem; }
    .auth-tabs{ display:flex; gap:6px; margin-bottom:10px; }
    .auth-tab{ flex:1; padding:10px; background:#1c2236; color:#9fb0c8; border:0; border-radius:10px; cursor:pointer; font-weight:700; }
    .auth-tab.active{ background:#2b3963; color:#fff; }
    .auth-field{ margin:8px 0; }
    .auth-field label{ display:block; font-size:12px; color:#9fb0c8; margin-bottom:4px; }
    .auth-field input{ width:100%; padding:10px; border-radius:10px; border:1px solid var(--border); background:#131a2d; color:#e8eef4; }
    .auth-actions{ display:flex; gap:8px; margin-top:10px; }
    .auth-actions button{ flex:1; padding:10px; border-radius:10px; border:0; cursor:pointer; font-weight:700; }
    .auth-primary{ background:#4f75ff; color:#fff; }
    .auth-secondary{ background:#29314a; color:#fff; }
    .auth-error{ color:#ff7676; font-size:12px; min-height:16px; margin-top:6px; }
    .auth-hint{ font-size:12px; color:#9fb0c8; margin-top:6px; }

    /* Toast */
    .toast{ position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#111827; color:#fff; padding:10px 14px; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.35); z-index:13000; display:none; }
  </style>
</head>
<body>
  <header>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h1>
    <span class="hello" id="hello"></span>
    <span class="spacer"></span>
    <button class="btn ghost" id="authOpen">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    <button class="btn" id="logoutBtn" style="display:none">–í—ã–π—Ç–∏</button>
    <button class="btn" id="moreBtn">–°–∫—Ä–∏–º–µ—Ä üòà</button>
  </header>
  <p class="lead">–ß–∞—Ç, ¬´–∑–≤–æ–Ω–æ–∫¬ª, –∑–≤—É–∫–∏ –∏ –∂–µ–Ω—Å–∫–∏–π –≥–æ–ª–æ—Å ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞.</p>

  <main>
    <h2>–û–±–æ –º–Ω–µ</h2>
    <p>–ö–æ–≥–¥–∞ –∂–∏–∑–Ω—å –¥–∞—ë—Ç –∫–∞–º–Ω–∏ ‚Äî –ø–æ–¥–Ω–∏–º–∞–π—Å—è –≤—ã—à–µ –∏ —Å–º–æ—Ç—Ä–∏ —à–∏—Ä–µ.</p>
    <img class="preview" src="myphoto.jpg" alt="–ú–æ—ë —Ñ–æ—Ç–æ" onerror="this.style.display='none'">
  </main>

  <footer>
    <p>¬© 2025 –ú–æ–π —Å–∞–π—Ç | –°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –∏ HTML</p>
  </footer>

  <!-- Screamer & BSOD -->
  <div id="screamer" class="overlay" aria-hidden="true">
    <img src="screamer.jpg" alt="">
    <audio id="screamSound" src="scream.mp3"></audio>
  </div>
  <div id="bsod" class="overlay" aria-hidden="true" title="–ö–ª–∏–∫ ‚Äî –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞">
    <img src="bsod.png" alt="">
  </div>

  <!-- Chat widget -->
  <div id="chatWidget" aria-live="polite">
    <div id="sv-ad">
      <div class="sv-photo">
        <img src="orig.png" alt="–°–≤–µ—Ç–ª–∞–Ω–∞" onerror="this.onerror=null; this.src='orig.jpg';">
      </div>
      <div class="sv-text">
        <div class="sv-title">–°–≤–µ—Ç–ª–∞–Ω–∞ –Ω–∞ —Å–≤—è–∑–∏</div>
        <div class="sv-sub"> 300–º –æ—Ç –í–∞—Å </div>
        <button class="sv-btn" id="sv-open"><span>–û–¢–í–ï–¢–ò–¢–¨</span><span class="sv-badge"></span></button>
      </div>
    </div>
    <div id="sv-chat">
      <div class="sv-header">
        <div class="sv-avatar"><img src="orig.png" alt="" onerror="this.onerror=null; this.src='orig.jpg';"></div>
        <div class="sv-name">–°–≤–µ—Ç–ª–∞–Ω–∞ ‚Ä¢ –ò–ò</div>
        <div class="sv-close" id="sv-close" title="–°–≤–µ—Ä–Ω—É—Ç—å">√ó</div>
      </div>
      <div class="sv-messages" id="sv-msgs">
        <div class="sv-msg sv-from"><b>–°–≤–µ—Ç–ª–∞–Ω–∞:</b> –ü—Ä–∏–≤–µ—Ç! –Ø —Ä—è–¥–æ–º. –ß–µ–º –ø–æ–º–æ—á—å? üòä</div>
      </div>
      <div class="sv-input">
        <input type="text" id="sv-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶">
        <button id="sv-send">‚û§</button>
      </div>
    </div>
  </div>

  <!-- Call overlay -->
  <div class="callui-overlay" id="callui">
    <div class="callui-card" role="dialog" aria-labelledby="calluiTitle" aria-describedby="calluiDesc">
      <div class="callui-status" id="calluiDesc">–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫</div>
      <div class="callui-phone" aria-hidden="true">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 011 1V20a1 1 0 01-1 1C11.3 21 3 12.7 3 2a1 1 0 011-1h3.5a1 1 0 011 1c0 1.25.2 2.46.57 3.58.11.32.03.68-.22.93l-2.23 2.23z" fill="currentColor"/>
        </svg>
      </div>
      <div class="callui-title" id="calluiTitle">–°–≤–µ—Ç–ª–∞–Ω–∞</div>
      <div class="callui-sub">–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —á–∞—Ç–∞</div>
      <div class="callui-actions">
        <div class="callui-grid" style="width: 220px;">
          <div class="callui-col">
            <button class="callui-btn callui-decline" id="calluiDecline" aria-label="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M21.16 13.87c-.73-.59-3.69-2.87-9.16-2.87s-8.43 2.28-9.16 2.87A1.99 1.99 0 002 15.45V17a2 2 0 002 2h2c.74 0 1.38-.41 1.72-1.02l.74-1.34a1.5 1.5 0 00-.55-2.03 12.47 12.47 0 014.37-.78c1.54 0 3.02.27 4.37.78.73.28 1.03 1.12.55 2.03l.74 1.34c.34.61.98 1.02 1.72 1.02h2a2 2 0 002-2v-1.55c0-.6-.27-1.17-.84-1.58z" fill="currentColor"/>
              </svg>
            </button>
            <div class="callui-caption">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</div>
          </div>
          <div class="callui-col">
            <button class="callui-btn callui-accept" id="calluiAccept" aria-label="–ü—Ä–∏–Ω—è—Ç—å –∑–≤–æ–Ω–æ–∫">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 011 1V20a1 1 0 01-1 1C11.3 21 3 12.7 3 2a1 1 0 011-1h3.5a1 1 0 011 1c0 1.25.2 2.46.57 3.58.11.32.03.68-.22.93l-2.23 2.23z" fill="currentColor"/>
              </svg>
            </button>
            <div class="callui-caption">–û—Ç–≤–µ—Ç–∏—Ç—å</div>
          </div>
        </div>
      </div>
      <div class="callui-timer" id="calluiTimer"></div>
    </div>
  </div>

  <!-- AUTH Modal -->
  <div class="auth-overlay" id="auth">
    <div class="auth-card">
      <h3 class="auth-title" id="authTitle">–í—Ö–æ–¥</h3>
      <div class="auth-tabs">
        <button class="auth-tab active" id="tabLogin">–í–æ–π—Ç–∏</button>
        <button class="auth-tab" id="tabRegister">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
      <div id="regNameWrap" class="auth-field" style="display:none">
        <label>–ò–º—è</label>
        <input type="text" id="regName" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è">
      </div>
      <div class="auth-field">
        <label>Email</label>
        <input type="email" id="authEmail" placeholder="you@example.com" autocomplete="email">
      </div>
      <div class="auth-field">
        <label>–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="authPass" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" autocomplete="current-password">
      </div>
      <div id="regConfirmWrap" class="auth-field" style="display:none">
        <label>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
        <input type="password" id="authPass2" placeholder="–ï—â—ë —Ä–∞–∑ –ø–∞—Ä–æ–ª—å" autocomplete="new-password">
      </div>
      <div class="auth-actions">
        <button class="auth-secondary" id="authCancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="auth-primary" id="authSubmit">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
      <div class="auth-error" id="authError"></div>
      <div class="auth-hint">–î–µ–º–æ-—Ä–µ–∂–∏–º: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (localStorage).</div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Show widget after load
    window.addEventListener('load',()=>{ setTimeout(()=>document.body.classList.add('sv-show'),1200); });
    const moreBtn=document.getElementById('moreBtn');
    const screamer=document.getElementById('screamer');
    const bsod=document.getElementById('bsod');
    const screamSound=document.getElementById('screamSound');
    moreBtn.addEventListener('click',()=>{
      const el=document.documentElement;
      (el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen||(()=>{})).call(el);
      screamer.style.display='flex';
      try{ screamSound.currentTime=0; screamSound.play(); }catch(_){}
      setTimeout(()=>{ screamer.style.display='none'; bsod.style.display='flex'; },2000);
    });
    bsod.addEventListener('click',()=>location.reload());

    /* ====== Toast ====== */
    const toast = document.getElementById('toast');
    function showToast(msg, ms=2200){
      toast.textContent=msg;
      toast.style.display='block';
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>{ toast.style.display='none'; }, ms);
    }

    /* ====== Simple Auth (localStorage + SHA-256) ====== */
    const authOverlay = document.getElementById('auth');
    const authOpen = document.getElementById('authOpen');
    const logoutBtn = document.getElementById('logoutBtn');
    const hello = document.getElementById('hello');
    const tabLogin = document.getElementById('tabLogin');
    const tabRegister = document.getElementById('tabRegister');
    const regNameWrap = document.getElementById('regNameWrap');
    const regConfirmWrap = document.getElementById('regConfirmWrap');
    const regName = document.getElementById('regName');
    const authEmail = document.getElementById('authEmail');
    const authPass = document.getElementById('authPass');
    const authPass2 = document.getElementById('authPass2');
    const authSubmit = document.getElementById('authSubmit');
    const authCancel = document.getElementById('authCancel');
    const authError = document.getElementById('authError');
    const authTitle = document.getElementById('authTitle');
    let mode = 'login'; // 'login' | 'register'

    function openAuth(wanted='login'){
      mode = wanted;
      authTitle.textContent = wanted==='login' ? '–í—Ö–æ–¥' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
      tabLogin.classList.toggle('active', wanted==='login');
      tabRegister.classList.toggle('active', wanted==='register');
      regNameWrap.style.display = wanted==='register' ? '' : 'none';
      regConfirmWrap.style.display = wanted==='register' ? '' : 'none';
      authEmail.value=''; authPass.value=''; authPass2.value=''; regName.value='';
      authError.textContent='';
      authOverlay.style.display='flex';
      setTimeout(()=>authEmail.focus(), 30);
    }
    function closeAuth(){ authOverlay.style.display='none'; }
    tabLogin.addEventListener('click',()=>openAuth('login'));
    tabRegister.addEventListener('click',()=>openAuth('register'));
    authOpen.addEventListener('click',()=>openAuth('login'));
    authCancel.addEventListener('click',closeAuth);
    authOverlay.addEventListener('click',e=>{ if(e.target===authOverlay) closeAuth(); });

    function isValidEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }
    function sha256(str){
      const enc = new TextEncoder().encode(str);
      return crypto.subtle.digest('SHA-256', enc).then(buf => {
        const b = new Uint8Array(buf);
        let s=''; for(let i=0;i<b.length;i++){ s+=String.fromCharCode(b[i]); }
        return btoa(s);
      });
    }

    function getUser(){ try{ return JSON.parse(localStorage.getItem('sv_user')||'null'); }catch(e){ return null; } }
    function setUser(u){ localStorage.setItem('sv_user', JSON.stringify(u)); }
    function clearUser(){ localStorage.removeItem('sv_user'); }

    function updateAuthUI(){
      const u = getUser();
      if(u){
        hello.textContent = '–ü—Ä–∏–≤–µ—Ç, ' + (u.name||u.email);
        authOpen.style.display='none';
        logoutBtn.style.display='inline-block';
      }else{
        hello.textContent = '';
        authOpen.style.display='inline-block';
        logoutBtn.style.display='none';
      }
    }
    logoutBtn.addEventListener('click',()=>{
      clearUser(); updateAuthUI();
      showToast('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞');
    });

    authSubmit.addEventListener('click', async ()=>{
      const email = authEmail.value.trim().toLowerCase();
      const pass = authPass.value;
      const name = regName.value.trim();
      if(!isValidEmail(email)){ authError.textContent='–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email'; return; }
      if(pass.length < 6){ authError.textContent='–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 6 —Å–∏–º–≤–æ–ª–æ–≤'; return; }
      if(mode==='register'){
        if(pass !== authPass2.value){ authError.textContent='–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'; return; }
        const passHash = await sha256(pass);
        // –ø—Ä–æ—Å—Ç–∞—è "–ë–î" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {email:{passHash,name,createdAt}}
        const db = JSON.parse(localStorage.getItem('sv_users')||'{}');
        if(db[email]){ authError.textContent='–¢–∞–∫–æ–π email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'; return; }
        db[email] = { passHash, name, createdAt: Date.now() };
        localStorage.setItem('sv_users', JSON.stringify(db));
        setUser({ email, name });
        closeAuth(); updateAuthUI();
        showToast('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞');
      }else{
        const db = JSON.parse(localStorage.getItem('sv_users')||'{}');
        if(!db[email]){ authError.textContent='–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.'; return; }
        const passHash = await sha256(pass);
        if(db[email].passHash !== passHash){ authError.textContent='–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å'; return; }
        setUser({ email, name: db[email].name });
        closeAuth(); updateAuthUI();
        showToast('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
      }
    });
    updateAuthUI();

    /* ====== Chat controls (–≥–µ–π—Ç –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) ====== */
    const svOpen=document.getElementById('sv-open');
    const svAd=document.getElementById('sv-ad');
    const svChat=document.getElementById('sv-chat');
    const svClose=document.getElementById('sv-close');
    const svMsgs=document.getElementById('sv-msgs');
    const svInput=document.getElementById('sv-input');
    const svSend=document.getElementById('sv-send');

    function requireAuth(action){
      if(!getUser()){
        openAuth('login');
        showToast('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã ' + (action||'–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å'));
        return false;
      }
      return true;
    }

    svOpen.addEventListener('click',(e)=>{
      e.preventDefault();
      if(!requireAuth('–æ–±—â–∞—Ç—å—Å—è –≤ —á–∞—Ç–µ')) return;
      svAd.style.display='none'; svChat.style.display='flex'; setTimeout(()=>svInput.focus(),50);
    });
    svClose.addEventListener('click',()=>{ svChat.style.display='none'; svAd.style.display='flex'; });

    /* ====== Audio (ring/accept/end) ====== */
    let actx=null, masterGain=null, rtGain=null, rtOsc1=null, rtOsc2=null, rtTick=null;
    function ensureAudio(){
      if(!actx){
        actx=new (window.AudioContext||window.webkitAudioContext)();
        masterGain=actx.createGain(); masterGain.gain.value=0.9; masterGain.connect(actx.destination);
      }
      if(actx.state==='suspended'){ actx.resume?.(); }
    }
    function stopRingtone(){
      if(rtTick){ clearInterval(rtTick); rtTick=null; }
      try{ rtGain && (rtGain.gain.value=0); }catch(e){}
      try{ rtOsc1 && rtOsc1.stop(0); }catch(e){}
      try{ rtOsc2 && rtOsc2.stop(0); }catch(e){}
      rtGain=null; rtOsc1=null; rtOsc2=null;
    }
    function playRingtone(){
      ensureAudio(); stopRingtone();
      rtGain=actx.createGain(); rtGain.gain.value=0; rtGain.connect(masterGain);
      rtOsc1=actx.createOscillator(); rtOsc1.type='sine'; rtOsc1.frequency.value=440;
      rtOsc2=actx.createOscillator(); rtOsc2.type='sine'; rtOsc2.frequency.value=660;
      rtOsc1.connect(rtGain); rtOsc2.connect(rtGain);
      rtOsc1.start(); rtOsc2.start();
      function burst(){
        const now=actx.currentTime, g=rtGain.gain;
        g.cancelScheduledValues(now);
        g.setValueAtTime(0.0, now);
        g.linearRampToValueAtTime(0.22, now+0.02);
        g.setValueAtTime(0.22, now+0.38);
        g.linearRampToValueAtTime(0.0, now+0.42);
        g.setValueAtTime(0.0, now+0.62);
        g.linearRampToValueAtTime(0.22, now+0.64);
        g.setValueAtTime(0.22, now+1.00);
        g.linearRampToValueAtTime(0.0, now+1.04);
      }
      burst();
      rtTick=setInterval(burst, 2600);
    }
    function blip(type='up'){
      ensureAudio();
      const o=actx.createOscillator(), g=actx.createGain(); o.type='sine'; g.gain.value=0; o.connect(g).connect(masterGain);
      const now=actx.currentTime;
      if(type==='up'){ o.frequency.setValueAtTime(660, now); o.frequency.exponentialRampToValueAtTime(1200, now+0.16);
        g.gain.linearRampToValueAtTime(0.22, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.24);
        o.start(now); o.stop(now+0.26);
      } else { o.frequency.setValueAtTime(900, now); o.frequency.exponentialRampToValueAtTime(360, now+0.22);
        g.gain.linearRampToValueAtTime(0.22, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.24);
        o.start(now); o.stop(now+0.26); }
    }

    /* ====== TTS (female ru-RU) ====== */
    function pickRUVoice(){
      const voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
      if(!voices || !voices.length) return null;
      const ru = voices.filter(v => (v.lang||'').toLowerCase().startsWith('ru'));
      const prefer = ['milena','irina','tatiana','tatyana','oksana','katya','katia','anna','google —Ä—É—Å—Å–∫–∏–π','–ºicrosoft irina','microsoft irina'];
      for(const name of prefer){ const v = ru.find(v => v.name && v.name.toLowerCase().includes(name)); if(v) return v; }
      return ru[0] || voices[0] || null;
    }
    function ensureVoicesReady(){
      return new Promise(resolve=>{
        if(!('speechSynthesis' in window)) return resolve(false);
        const voices = speechSynthesis.getVoices();
        if(voices && voices.length) return resolve(true);
        const t = setTimeout(()=>resolve(true), 700);
        speechSynthesis.onvoiceschanged = () => { clearTimeout(t); resolve(true); };
      });
    }
    function speakRU(text, opts={}){
      if(!('speechSynthesis' in window)) return false;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ru-RU'; u.rate = opts.rate ?? 1; u.pitch = opts.pitch ?? 1.15; u.volume = opts.volume ?? 1;
      const v = pickRUVoice(); if(v) u.voice = v;
      try{ speechSynthesis.cancel(); }catch(_){}
      try{ speechSynthesis.speak(u); return true; }catch(_){ return false; }
    }

    /* ====== Call UI control ====== */
    (function(){
      const overlay = document.getElementById('callui');
      const decline = document.getElementById('calluiDecline');
      const accept = document.getElementById('calluiAccept');
      const status = document.getElementById('calluiDesc');
      const timer = document.getElementById('calluiTimer');
      let callInterval = null, callStartTime = null;

      function formatTimer(sec){ const m = String(Math.floor(sec/60)).padStart(2,'0'); const s = String(sec%60)).padStart(2,'0'); return `${m}:${s}`; }
      function openUI(){
        if(!getUser()){ openAuth('login'); showToast('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–≤–æ–Ω–∫–∏'); return; }
        overlay.style.display='flex'; status.textContent='–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫'; timer.textContent=''; document.documentElement.style.overflow='hidden'; clearInterval(callInterval); callStartTime=null; playRingtone();
      }
      function closeUI(playEnd=true){ overlay.style.display='none'; document.documentElement.style.overflow=''; clearInterval(callInterval); timer.textContent=''; callStartTime=null; stopRingtone(); if(playEnd) blip('down'); }
      window.__callUI = { open: openUI, close: closeUI };

      decline.addEventListener('click', () => closeUI(true));
      accept.addEventListener('click', async () => {
        stopRingtone(); blip('up'); status.textContent='–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ‚Ä¶'; timer.textContent=''; clearInterval(callInterval);
        setTimeout(async ()=>{
          status.textContent='–ó–≤–æ–Ω–æ–∫ –∏–¥–µ—Ç'; callStartTime=Date.now(); timer.textContent='00:00';
          callInterval=setInterval(()=>{ const s=Math.floor((Date.now()-callStartTime)/1000); timer.textContent=formatTimer(s); },1000);
          await ensureVoicesReady(); speakRU('–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ –°–≤–µ—Ç–ª–∞–Ω–∞. –¢—ã –º–µ–Ω—è —Å–ª—ã—à–∏—à—å?', { pitch:1.2, rate:1.0 });
        },1200);
      });
      overlay.addEventListener('click', e=>{ if(e.target===overlay) closeUI(true); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && overlay.style.display==='flex') closeUI(true); });
    })();

    /* ====== AI-like replies (rules) ====== */
    function detectIntent(t){
      const s = (t||'').toLowerCase();
      if(/[^\w]?(–ø—Ä–∏–≤|–∑–¥—Ä–∞|—Ö–∞–π|–∫—É|—Å–∞–ª—é—Ç)/.test(s)) return 'greet';
      if(/(–∫–∞–∫ –¥–µ–ª–∞|–∫–∞–∫ —Ç—ã|—á—Ç–æ –¥–µ–ª–∞–µ—à—å)/.test(s)) return 'smalltalk';
      if(/(–≥–¥–µ|—Ä—è–¥–æ–º|—Ç—ã –≥–¥–µ|–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ|–ª–æ–∫–∞—Ü)/.test(s)) return 'where';
      if(/(—Ü–µ–Ω–∞|—Å–∫–æ–ª—å–∫–æ|–ø—Ä–∞–π—Å)/.test(s)) return 'price';
      if(/(—Å–æ–∑–≤–æ–Ω|–ø–æ–∑–≤–æ–Ω|–∑–≤–æ–Ω–æ–∫|–ø–æ–∑–≤–æ–Ω–∏–º|—Å–≤—è–∂–µ–º—Å—è)/.test(s)) return 'call';
      if(/[?]$/.test(s)) return 'question';
      return 'other';
    }
    function genReply(text){
      const intent = detectIntent(text);
      const rand = (arr)=>arr[Math.floor(Math.random()*arr.length)];
      const fillers = ['üôÇ','üòâ','‚ú®','üëç','üìû','üí¨'];
      if(intent==='call'){ // —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ –∑–≤–æ–Ω–∫–∞
        return '–û–≥–æ, –¥–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è! ' + rand(fillers);
      }
      switch(intent){
        case 'greet': return rand(['–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —É —Ç–µ–±—è –¥–µ–ª–∞?','–ü—Ä–∏–≤–µ—Ç–∏–∫ üòä –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?','–°–∞–ª—é—Ç! –ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º?']) + ' ' + rand(fillers);
        case 'smalltalk': return rand(['–û—Ç–ª–∏—á–Ω–æ, –Ω–∞ —Å–≤—è–∑–∏!','–í—Å—ë —Ö–æ—Ä–æ—à–æ, —Ä—è–¥–æ–º üòâ','–ü–∏—à—É –∫–æ–¥ –∏ –¥—É–º–∞—é –æ –∫–æ—Ñ–µ ‚òï']) + ' ' + rand(fillers);
        case 'where': return rand(['–Ø –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏ ‚Äî –º–∏–Ω—É—Ç 5 –æ—Ç —Ç–µ–±—è.','–Ø —Ç—É—Ç, –Ω–µ–¥–∞–ª–µ–∫–æ. –ú–æ–≥—É –ø–æ–¥–æ–π—Ç–∏.','–í —Ä–∞–π–æ–Ω–µ, –µ—Å–ª–∏ —á—Ç–æ ‚Äî –º–∞—è–∫—É–π.']) + ' ' + rand(fillers);
        case 'price': return rand(['–†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ ‚Äî –ø–æ–¥—Å–∫–∞–∂—É –≤–∞—Ä–∏–∞–Ω—Ç—ã.','–î–∞–≤–∞–π —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏, –∏ —è —Å–∫–∞–∂—É —Ç–æ—á–Ω–µ–µ.','–ù–∞–ø–∏—à–∏, —á—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º ‚Äî —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—é –ø–æ —Ü–µ–Ω–µ.']) + ' ' + rand(fillers);
        case 'question': return '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! ' + rand(['–°–∫–∞–∂–∏ —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ?','–î–∞–≤–∞–π —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏.','–ï—Å—Ç—å –ø–∞—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Äî –∫–∞–∫–æ–π –±–ª–∏–∂–µ?']) + ' ' + rand(fillers);
        default: return rand(['–ü–æ–Ω—è–ª–∞ —Ç–µ–±—è.','–û–∫–µ–π!','–°—É–ø–µ—Ä!']) + ' ' + (text||'').trim();
      }
    }
    function addTyping(){
      const wrap=document.createElement('div'); wrap.className='sv-msg sv-from'; wrap.id='typing';
      wrap.innerHTML='<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>';
      svMsgs.appendChild(wrap); svMsgs.scrollTop=svMsgs.scrollHeight;
    }
    function removeTyping(){ const t=document.getElementById('typing'); if(t) t.remove(); }
    function aiRespond(userText){
      const reply = genReply(userText);
      const delay = Math.min(2200, 300 + reply.length*20);
      addTyping();
      setTimeout(()=>{
        removeTyping();
        const m=document.createElement('div'); m.className='sv-msg sv-from'; m.innerHTML='<b>–°–≤–µ—Ç–ª–∞–Ω–∞:</b> ' + reply;
        svMsgs.appendChild(m); svMsgs.scrollTop=svMsgs.scrollHeight;
        // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—á–Ω—É—é —Ñ—Ä–∞–∑—É ‚Äî —á–µ—Ä–µ–∑ 2—Å –∑–∞–ø—É—Å–∫–∞–µ–º –∑–≤–æ–Ω–æ–∫
        if (reply.includes('–û–≥–æ, –¥–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è!')){
          setTimeout(()=>{ window.__callUI?.open(); }, 2000);
        }
      }, delay);
    }

    function sendMsg(){
      if(!requireAuth('–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è')) return;
      const text=svInput.value.trim();
      if(!text) return;
      const mine=document.createElement('div');
      mine.className='sv-msg sv-to';
      mine.innerHTML=`<b>–í—ã:</b> ${text}`;
      svMsgs.appendChild(mine);
      svInput.value='';
      svMsgs.scrollTop=svMsgs.scrollHeight;
      aiRespond(text);
    }
    svSend.addEventListener('click',sendMsg);
    svInput.addEventListener('keydown',e=>{ if(e.key==='Enter') sendMsg(); });

    // Show widget after load
    window.addEventListener('load',()=>{ setTimeout(()=>document.body.classList.add('sv-show'),1200); });
  </script>
</body>
</html>
